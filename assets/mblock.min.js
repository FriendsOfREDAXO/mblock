function mblock_show_message(e,t="warning",o=5e3){"undefined"!=typeof BLOECKS&&BLOECKS.fireMBlockToast?BLOECKS.fireMBlockToast(e,t,o):"undefined"!=typeof BLOECKS&&BLOECKS.showToast?BLOECKS.showToast(e,t,o):(void 0!==s&&s.show&&s.show(e,t,o),"error"===t||"danger"===t?console.error("MBlock:",e):console.warn("MBlock:",e))}function mblock_get_text(e,t=""){if("undefined"!=typeof rex&&rex.mblock_i18n&&rex.mblock_i18n[e.replace("mblock_toast_","")])return rex.mblock_i18n[e.replace("mblock_toast_","")];if("undefined"!=typeof rex&&rex.i18n){const o=rex.i18n.msg(e);return o!==e?o:t}const o=(navigator.language||"de").substring(0,2),n={mblock_toast_copy_success:{de:"Block erfolgreich kopiert!",en:"Block copied successfully!",es:"\xa1Bloque copiado con \xe9xito!",pt:"Bloco copiado com sucesso!",sv:"Block kopierat framg\xe5ngsrikt!",nl:"Blok succesvol gekopieerd!"},mblock_toast_paste_success:{de:"Block erfolgreich eingef\xfcgt!",en:"Block pasted successfully!",es:"\xa1Bloque pegado con \xe9xito!",pt:"Bloco colado com sucesso!",sv:"Block inklistrat framg\xe5ngsrikt!",nl:"Blok succesvol geplakt!"},mblock_toast_clipboard_empty:{de:"Keine Daten in der Zwischenablage",en:"No data in clipboard",es:"No hay datos en el portapapeles",pt:"Nenhum dado na \xe1rea de transfer\xeancia",sv:"Inga data i urklipp",nl:"Geen gegevens in klembord"},mblock_toast_module_type_mismatch:{de:"Modultyp stimmt nicht \xfcberein",en:"Module type mismatch",es:"No coincide el tipo de m\xf3dulo",pt:"Tipo de m\xf3dulo n\xe3o corresponde",sv:"Modultyp matchar inte",nl:"Moduletype komt niet overeen"}}[e];return n&&n[o]?n[o]:n&&n.de?n.de:t}function mblock_validate_element(e){try{return!!e&&(e.jquery?e.length>0&&"function"==typeof e.data:!!e.nodeType||"string"==typeof e&&e.length>0)}catch(t){return console.error("MBlock: Fehler bei Element-Validierung:",t),!1}}function e(){try{const e=$(".mblock_wrapper").first();if(e.length){const t=e.attr("data-copy_paste");if(void 0!==t)return"true"===t||"1"===t}const t=$(".mblock-copy-btn").length>0,o=$(".mblock-copy-paste-toolbar").length>0;return t||o}catch(e){return console.warn("MBlock: Fehler beim Pr\xfcfen der Copy/Paste-Konfiguration:",e),!0}}function mblock_smooth_scroll_to_element(e,t={}){if(!e)return;if("undefined"!=typeof BLOECKS&&"function"==typeof BLOECKS.scrollToSlice)try{return void BLOECKS.scrollToSlice(e)}catch(n){console.warn("MBlock: Bloecks scroll failed, using fallback:",n)}const o={behavior:"smooth",block:"center",inline:"nearest",offset:-20,...t};try{if("scrollIntoView"in e){const t=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:Math.max(0,t+o.offset),behavior:o.behavior})}else e.scrollIntoView(o)}catch(n){try{e.scrollIntoView()}catch(i){console.warn("MBlock: Scroll fallback failed:",i)}}}function mblock_init(t){try{return t&&t.length&&"function"==typeof t.data?(t.data("mblock_run")||(t.data("mblock_run",!0),mblock_init_sort(t),(function(e){const t=e.find("> div.sortitem").length>0,o=e.find("> div.mblock-single-add").length>0;t||o?t&&o&&e.find("> div.mblock-single-add").remove():(e.prepend($($.parseHTML(e.data("mblock-single-add")))),e.find("> div.mblock-single-add .addme").unbind().bind("click",function(){n($(this).closest(".mblock_wrapper"),!1)}))})(t),(function(t){try{if(!e())return;[{selector:".mblock-copy-paste-toolbar .mblock-paste-btn",handler:function(e){e.preventDefault();const t=$(this).closest(".mblock_wrapper");void 0!==MBlockClipboard&&MBlockClipboard.paste(t,!1)}},{selector:".mblock-copy-paste-toolbar .mblock-clear-clipboard",handler:function(e){e.preventDefault(),void 0!==MBlockClipboard&&(MBlockClipboard.clear(),mblock_show_message("Zwischenablage geleert","info",2e3))}}].forEach(({selector:e,handler:o})=>{MBlockUtils.events.bindSafe(MBlockUtils.dom.findElement(t,e),"click",o)})}catch(o){console.error("MBlock: Fehler in mblock_init_toolbar:",o)}})(t),void 0!==MBlockOnlineToggle&&MBlockOnlineToggle.initializeStates(t)),!0):(console.warn("MBlock: Invalid element passed to mblock_init"),!1)}catch(o){return console.error("MBlock: Fehler in mblock_init:",o),!1}}function mblock_init_sort(e){try{return e&&e.length?(o(e),(function(e){try{return e&&e.length?(mblock_add(e),t(e),(function(e){try{if(!MBlockUtils.is.validElement(e)||!e.length||!e.get)return console.warn("MBlock: Invalid element passed to mblock_sort_it"),!1;const t=e.get(0);if(!document.contains(t))return console.warn("MBlock: Element not in DOM, skipping sortable initialization"),!1;if("undefined"!=typeof Sortable&&Sortable.create){const o=Sortable.create(t,{handle:".mblock-handle",animation:150,ghostClass:"mblock-sortable-ghost",chosenClass:"mblock-sortable-chosen",dragClass:"mblock-sortable-drag",onStart:function(e){a._handleStart(e)},onEnd:function(t){a._handleEnd(t,e)}});e.data("sortable-instance",o)}else a.create(e)}catch(t){return console.error("MBlock: Fehler in mblock_sort_it:",t),!1}})(e),!0):(console.warn("MBlock: Invalid element passed to mblock_sort"),!1)}catch(o){return console.error("MBlock: Fehler in mblock_sort:",o),!1}})(e),!0):(console.warn("MBlock: Invalid element passed to mblock_init_sort"),!1)}catch(n){return console.error("MBlock: Fehler in mblock_init_sort:",n),!1}}function t(e){var t=e.find("> div.sortitem");1==t.length?(t.find(".removeme").prop("disabled",!0),t.find(".removeme").attr("data-disabled",!0)):(t.find(".removeme").prop("disabled",!1),t.find(".removeme").attr("data-disabled",!1)),e.data().hasOwnProperty("max")&&(t.length>=e.data("max")?(e.find(".addme").prop("disabled",!0),e.find(".addme").attr("data-disabled",!0)):(e.find(".addme").prop("disabled",!1),e.find(".addme").attr("data-disabled",!1))),e.data().hasOwnProperty("min")&&(t.length<=e.data("min")?(t.find(".removeme").prop("disabled",!0),t.find(".removeme").attr("data-disabled",!0)):(t.find(".removeme").prop("disabled",!1),t.find(".removeme").attr("data-disabled",!1))),t.each(function(o){o+1==e.data("min")&&t.length==e.data("min")&&$(this).find(".removeme").hide(),0==o?$(this).find(".moveup").prop("disabled",!0):$(this).find(".moveup").prop("disabled",!1),o+1==t.length?$(this).find(".movedown").prop("disabled",!0):$(this).find(".movedown").prop("disabled",!1)})}function o(e){try{if(!mblock_validate_element(e))return console.warn("MBlock: Invalid element passed to mblock_reindex"),!1;e.data("mblock_count");const t=e.find("> div.sortitem");return!t.length||(t.each(function(e){const t=$(this),o=e+1;t.attr("data-mblock_index",o),t.data("mblock_index",o),(function(e,t,o){try{e.find("input,textarea,select,button").each(function(){const e=$(this),t=e.attr("id"),n=e.attr("name");if(t||n){if(t){const n=t.replace(/_\d+/,"_"+o);e.attr("id",n)}if(n){let t=n.replace(/^mblock_new_/,"");t=t.replace(/\[(\d+)\]/,"["+o+"]"),e.attr("name",t)}!(function(e,t){try{const o=e.attr("id"),n=e.prop("nodeName");if(!o)return;const i=[{type:"SELECT",patterns:["REX_MEDIALIST_SELECT_","REX_LINKLIST_SELECT_"],handler:(t,o)=>{e.attr("id",t),o&&e.attr("name",o)}},{type:"INPUT",patterns:["REX_MEDIA_","REX_LINKLIST_","REX_MEDIALIST_"],handler:t=>{e.attr("id",t)}}].find(e=>e.type===n&&e.patterns.some(e=>o.indexOf(e)>=0));if(i){const n=o.replace(/_\d+/,"_"+t),c=e.attr("name")?.replace(/\[(\d+)\]/,"["+t+"]");i.handler(n,c)}}catch(o){console.error("MBlock: Fehler in mblock_update_rex_ids:",o)}})(e,o),(function(e,t){try{e.parent().find("a.btn-popup").each(function(){const e=$(this),o=e.attr("onclick");if(o){const n=o.replace(/_\d+/,"_"+t);e.attr("onclick",n)}})}catch(o){console.error("MBlock: Fehler in mblock_update_rex_buttons:",o)}})(e,o)}})}catch(n){console.error("MBlock: Fehler in mblock_reindex_form_elements:",n)}})(t,0,o),(function(e,t,o){try{e.find('a[data-toggle="tab"]').each(function(){const e=$(this),t=e.attr("href");if(t){const n=t.replace(/_\d+/,"_"+o);e.attr("href",n)}}),e.find('a[data-toggle="collapse"]').each(function(){const e=$(this),t=e.attr("href")||e.attr("data-target");if(t){const n=t.replace(/_\d+/,"_"+o);e.attr("href",n),e.attr("data-target",n)}}),e.find(".custom-link").each(function(){const e=$(this),t=e.attr("href");if(t){const n=t.replace(/_\d+/,"_"+o);e.attr("href",n)}})}catch(n){console.error("MBlock: Fehler in mblock_reindex_special_elements:",n)}})(t,0,o)}),(function(e){e.find("> div.sortitem").each(function(){var e=$(this);e.find("input:not(:checkbox):not(:radio),textarea,select").each(function(){var t,o=$(this).attr("id");o&&(t=e.find('label[for="'+o+'"]')).length>0&&t.attr("for",o)})})})(e),!0)}catch(t){return console.error("MBlock: Fehler in mblock_reindex:",t),!1}}function n(e,t){const o=MBlockUtils.dom.createFromHTML(e.data("mblock-plain-sortitem"));o.find("input:radio, input:checkbox").each(function(){$(this).parent().removeAttr("for")}),o.find("input:radio, input:checkbox").each(function(){$(this).attr("name","mblock_new_"+$(this).attr("name")),$(this).attr("data-value",$(this).val())}),!1===t?e.prepend(o):t.parent().hasClass(e.attr("class"))&&t.after(o),i(o,!0),mblock_init_sort(e),o.trigger("rex:ready",[o]),setTimeout(function(){MBlockUtils.nested.initializeNested(o),"function"==typeof $.fn.selectpicker&&o.find("select.selectpicker").selectpicker("refresh"),"function"==typeof $.fn.chosen&&o.find("select").chosen("destroy").chosen(),c(o),o.find("input, select, textarea").trigger("change")},50),setTimeout(function(){o&&o.length&&o.is(":visible")&&mblock_smooth_scroll_to_element(o.get(0))},100),setTimeout(()=>{MBlockUtils.animation.flashEffect(o),mblock_show_message(mblock_get_text("mblock_toast_add_success","Block erfolgreich hinzugef\xfcgt!"),"success",3e3)},150)}function i(e,t){try{return e&&e.length&&"function"==typeof e.find?(e.find("input").each(function(){const e=$(this),o=e.attr("name");if(o&&t){const t=o.replace(/_unique_\w+/,"");e.attr("name",t)}if(o&&!o.includes("_unique_")){const t=Date.now()+Math.random().toString(36).substring(2,11),n=o.replace(/(\w+)(\[.*\])?$/,"$1_unique_"+t+"$2");e.attr("name",n)}}),!0):(console.warn("MBlock: Invalid item passed to mblock_set_unique_id"),!1)}catch(o){return console.error("MBlock: Fehler in mblock_set_unique_id:",o),!1}}function mblock_add(i){try{if(!MBlockUtils.is.validElement(i)||!i.length)return console.warn("MBlock: Invalid element passed to mblock_add"),!1;const c=[{selector:MBlockUtils.selectors.addme,event:"click",handler:function(e){e.preventDefault(),n($(this).closest(".mblock_wrapper"),$(this).closest(".sortitem"))}},{selector:MBlockUtils.selectors.removeme,event:"click",handler:function(e){e.preventDefault(),(function(e,n){try{if(!(MBlockUtils.is.validElement(e)&&e.length&&n&&n.length))return console.warn("MBlock: Invalid parameters passed to mblock_remove_item"),!1;const i=e.data();if(i&&i.hasOwnProperty("delete_confirm")&&!confirm(i.delete_confirm))return!1;const c=n.parent(),l=e.attr("class");return!!(c.length&&l&&c.hasClass(l))&&(MBlockUtils.dom.safeRemove(n),o(e),t(e),!0)}catch(i){return console.error("MBlock: Fehler in mblock_remove_item:",i),!1}})($(this).closest(".mblock_wrapper"),$(this).closest(".sortitem"))}},{selector:MBlockUtils.selectors.moveup,event:"click",handler:function(e){e.preventDefault(),(function(e,n){var i=n.prev();0!=i.length&&setTimeout(function(){n.insertBefore(i),o(e),t(e),i.trigger("mblock:change",[i])},150)})($(this).closest(".mblock_wrapper"),$(this).closest(".sortitem"))}},{selector:MBlockUtils.selectors.movedown,event:"click",handler:function(e){e.preventDefault(),(function(e,n){var i=n.next();0!=i.length&&setTimeout(function(){n.insertAfter(i),o(e),t(e),i.trigger("mblock:change",[i])},150)})($(this).closest(".mblock_wrapper"),$(this).closest(".sortitem"))}}];return c.forEach(({selector:e,event:t,handler:o})=>{MBlockUtils.events.bindSafe(MBlockUtils.dom.findElement(i,e),t,o)}),e()&&mblock_add._bindCopyPasteHandlers(i),mblock_add._bindToggleHandlers(i),e()&&void 0!==MBlockClipboard&&MBlockClipboard.updatePasteButtons(),void 0!==MBlockOnlineToggle&&MBlockOnlineToggle.initializeStates(i),!0}catch(c){return console.error("MBlock: Fehler in mblock_add:",c),!1}}function c(e){try{if(!e||!e.length)return console.warn("MBlock: Invalid container passed to reinitialize_redaxo_widgets"),!1;const t=parseInt(e.attr("data-mblock_index"))||1,o=(e.closest(".mblock_wrapper").find(".sortitem"),e.closest(".gridblock_wrapper").length>0||e.hasClass("gridblock-item"));return e.find('input[id^="REX_MEDIA_"]').each(function(){const o=$(this),n=o.attr("id"),i=n.replace(/_\d+$/,"_"+t);o.attr("id",i);const c='a[href*="media_id='+n.replace("REX_MEDIA_","")+'"]';e.find(c).each(function(){const e=$(this),o=e.attr("href");if(o){const n=o.replace(/media_id=\d+/,"media_id="+t);e.attr("href",n)}})}),e.find('input[id^="REX_LINK_"]').each(function(){const o=$(this),n=o.attr("id"),i=n.replace(/_\d+$/,"_"+t);o.attr("id",i);const c='a[href*="link_id='+n.replace("REX_LINK_","")+'"]';e.find(c).each(function(){const e=$(this),o=e.attr("href");if(o){const n=o.replace(/link_id=\d+/,"link_id="+t);e.attr("href",n)}})}),e.find('input[id^="REX_LINKLIST_"]').each(function(){const e=$(this),o=e.attr("id").replace(/_\d+$/,"_"+t);e.attr("id",o)}),o&&e.trigger("rex:ready",[e]),setTimeout(()=>{"function"==typeof $.fn.selectpicker&&e.find("select.selectpicker").selectpicker("refresh"),"function"==typeof $.fn.chosen&&e.find("select").chosen("destroy").chosen()},50),!0}catch(t){return console.error("MBlock: Fehler bei der Reinitialisierung der REDAXO Widgets:",t),!1}}function l(e,t){if(!e||!t||!t.length)return;if(window.mblock_article_cache||(window.mblock_article_cache={}),window.mblock_article_cache[e])return void t.val(window.mblock_article_cache[e]);const o=$('input[name="clang"]').val()||1,n=new URLSearchParams({page:"structure/linkmap",opener_input_field:"temp",article_id:e,clang:o}),i=rex.backend+"?"+n.toString();$.ajax({url:i,method:"GET",timeout:5e3,success:function(o){let n="";const i=[/<a[^>]+onclick="[^"]*selectLink[^"]*"[^>]*>([^<]+)</gi,/<span[^>]*class="[^"]*article[^"]*"[^>]*>([^<]+)</gi,/article_name['"]*:\s*['"]([^'"]+)['"]/gi,/"name"\s*:\s*"([^"]+)"/gi];for(const e of i){const t=e.exec(o);if(t&&t[1]){n=t[1].trim();break}}n||(n="Artikel ["+e+"]"),window.mblock_article_cache[e]=n,t.val(n),t.trigger("change")},error:function(){const o="Artikel ["+e+"]";window.mblock_article_cache[e]=o,t.val(o)}})}function r(){try{let e=0,t=0;$('input[id^="REX_LINK_"]').each(function(){const o=$(this),n=o.attr("id"),i=o.val();if(i&&"0"!==i){e++;const o=n.replace("REX_LINK_","REX_LINK_NAME_"),c=$("#"+o);c.length&&!c.val()&&(t++,l(i,c))}})}catch(e){console.error("MBlock: Fehler beim Initialisieren der REX_LINK Display-Felder:",e)}}var MBlockClipboard,MBlockOnlineToggle;const MBlockUtils={selectors:{wrapper:".mblock_wrapper",sortitem:"> div.sortitem",addme:".addme",removeme:".removeme",moveup:".moveup",movedown:".movedown",copyBtn:".mblock-copy-btn",pasteBtn:".mblock-paste-btn",onlineToggle:".mblock-online-toggle",autoToggle:".mblock-offline-toggle-btn"},dom:{findElement:(e,t)=>e?.find?e.find(t):$(t),safeRemove:e=>!!e?.length&&(e.find("*").off(".mblock"),e.off(".mblock"),e.remove(),!0),createFromHTML:e=>$($.parseHTML(e))},events:{bindSafe(e,t,o,n=".mblock"){e?.length&&e.off(t+n).on(t+n,o)},cleanup(e,t=".mblock"){mblock_validate_element(e)&&e.jquery&&(e.find("*").off(t),e.off(t))}},state:{isDisabled:e=>e.prop("disabled")||e.hasClass("disabled"),toggleDisabled(e,t){e.prop("disabled",t),e.toggleClass("disabled",t)}},nested:{cleanupDuplicates(e){try{if(!e||!e.length)return;e.find(".mblock_wrapper").each(function(){const e=$(this);e.data("mblock_initialized")&&e.removeData("mblock_initialized")})}catch(t){console.error("MBlock: Error cleaning up nested duplicates:",t)}},initializeNested(e){try{if(!e||!e.length)return;e.find(".mblock_wrapper").each(function(){const e=$(this);e.data("mblock_initialized")||(mblock_init(e),e.data("mblock_initialized",!0))})}catch(t){console.error("MBlock: Error initializing nested MBlocks:",t)}}},animation:{addGlowEffect(e,t="mblock-copy-glow",o=1e3){e?.length&&(e.addClass(t),setTimeout(()=>e.removeClass(t),o))},flashEffect(e,t="mblock-dropped-flash",o=600){e?.length&&(e.addClass(t),setTimeout(()=>e.removeClass(t),o))}},is:{validElement:e=>mblock_validate_element(e),rexField:(e,t)=>e&&e.indexOf(`REX_${t}_`)>=0,hiddenInput:e=>"hidden"===e.attr("type")}},s=(function(){let e=0,t=null;return{show:function(o,n="info",i=4e3){try{const c=t||(t=document.createElement("div"),t.className="mblock-toast-container",t.style.position="fixed",t.style.top="20px",t.style.right="20px",t.style.zIndex=99999,t.style.display="flex",t.style.flexDirection="column",t.style.gap="8px",document.body.appendChild(t),t),l="mblock-toast-"+ ++e,r=document.createElement("div");return r.id=l,r.className="mblock-toast mblock-toast-"+n,r.style.minWidth="180px",r.style.maxWidth="420px",r.style.padding="10px 14px",r.style.borderRadius="4px",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.12)",r.style.background="error"===n||"danger"===n?"#f8d7da":"success"===n?"#d4edda":"#fff3cd",r.style.color="#222",r.style.border="1px solid rgba(0,0,0,0.06)",r.style.fontSize="13px",r.innerText=o,c.appendChild(r),setTimeout(()=>{r.parentNode&&(r.style.opacity="0",r.style.transform="translateX(100%)")},Math.max(50,i-250)),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},i+100),l}catch(c){return console.warn("MBlock: Toast fallback failed",c),!1}}}})();"undefined"!=typeof module&&module.exports&&(module.exports={MBlockUtils:MBlockUtils,mblock_show_message:mblock_show_message,mblock_get_text:mblock_get_text,mblock_validate_element:mblock_validate_element});const a={destroy(e){try{if(e&&e.length&&e.data("sortable"))return e.sortable("destroy"),e.removeData("sortable"),!0}catch(t){console.warn("MBlock: Error destroying sortable:",t)}return!1},create(e){try{return!(!e||!e.length)&&(this.destroy(e),e.sortable({handle:".mblock-handle",placeholder:"mblock-sortable-placeholder",tolerance:"pointer",cursor:"move",axis:"y",containment:"parent",start:this._handleStart,stop:t=>this._handleEnd(t,e),update:t=>this._handleUpdate(t,e)}),e.data("sortable",!0),!0)}catch(t){return console.error("MBlock: Error creating sortable:",t),!1}},reinitialize(e){this.destroy(e),setTimeout(()=>this.create(e),10)},_handleStart(e){try{$(e.target).addClass("mblock-dragging")}catch(t){console.warn("MBlock: Error in sort start handler:",t)}},_handleEnd(e,t){try{$(e.target).removeClass("mblock-dragging"),o(t)}catch(n){console.warn("MBlock: Error in sort end handler:",n)}},_handleUpdate(e,n){try{o(n),t(n)}catch(i){console.warn("MBlock: Error in sort update handler:",i)}}};$(document).on("rex:ready",function(t,o){try{e()&&void 0!==MBlockClipboard&&MBlockClipboard.init(),o&&"function"==typeof o.find?o.find(".mblock_wrapper").each(function(){mblock_init($(this))}):$(".mblock_wrapper").each(function(){mblock_init($(this))})}catch(n){console.error("MBlock: Fehler bei rex:ready:",n)}}),mblock_add._bindCopyPasteHandlers=function(e){const t=MBlockUtils.dom.findElement(e,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.copyBtn}`);t.length>0&&MBlockUtils.events.bindSafe(t,"click",function(e){e.preventDefault();const t=$(this).closest(".mblock_wrapper"),o=$(this).closest(".sortitem");void 0!==MBlockClipboard&&MBlockClipboard.copy(t,o)});const o=MBlockUtils.dom.findElement(e,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.pasteBtn}`);o.length>0&&MBlockUtils.events.bindSafe(o,"click",function(e){e.preventDefault();const t=$(this).closest(".mblock_wrapper"),o=$(this).closest(".sortitem");void 0!==MBlockClipboard&&MBlockClipboard.paste(t,o)})},mblock_add._bindToggleHandlers=function(e){const t=MBlockUtils.dom.findElement(e,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.onlineToggle}`);MBlockUtils.events.bindSafe(t,"click",function(e){e.preventDefault();try{const e=$(this).closest(".mblock_wrapper"),t=$(this).closest(".sortitem");void 0!==MBlockOnlineToggle&&MBlockOnlineToggle.toggle(e,t)}catch(t){console.error("MBlock: Error in toggle handler:",t)}return!1});const o=MBlockUtils.dom.findElement(e,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.autoToggle}`);MBlockUtils.events.bindSafe(o,"click",function(e){e.preventDefault();try{const e=$(this).closest(".mblock_wrapper"),t=$(this).closest(".sortitem"),o=$(this);void 0!==MBlockOnlineToggle&&MBlockOnlineToggle.toggleAutoDetected(e,t,o)}catch(t){console.error("MBlock: Error in auto toggle handler:",t)}return!1})},"undefined"!=typeof module&&module.exports&&(module.exports={MBlockSortable:a}),MBlockClipboard={data:null,storageKey:"mblock_clipboard",useSessionStorage:!0,init:function(){try{this.loadFromStorage()}catch(e){console.warn("MBlock: Fehler beim Initialisieren des Clipboards:",e)}},getStorage:function(){try{return this.useSessionStorage?sessionStorage:localStorage}catch(e){return console.warn("MBlock: Storage nicht verf\xfcgbar:",e),null}},saveToStorage:function(){try{const e=this.getStorage();if(e&&this.data)return this.data.savedAt=(new Date).toISOString(),e.setItem(this.storageKey,JSON.stringify(this.data)),!0}catch(e){console.warn("MBlock: Fehler beim Speichern in Storage:",e)}return!1},loadFromStorage:function(){try{const e=this.getStorage();if(e){const t=e.getItem(this.storageKey);if(t)return this.data=JSON.parse(t),!0}}catch(e){console.warn("MBlock: Fehler beim Laden aus Storage:",e),this.clearStorage()}return!1},clearStorage:function(){try{const e=this.getStorage();e&&e.removeItem(this.storageKey)}catch(e){console.warn("MBlock: Fehler beim Leeren des Storages:",e)}},getSessionId:function(){return this._sessionId||(this._sessionId=Date.now().toString()+Math.random().toString(36).substring(2,11)),this._sessionId},toggleStorageMode:function(){const e=this.data;return this.clearStorage(),this.useSessionStorage=!this.useSessionStorage,e&&(this.data=e,this.saveToStorage()),this.useSessionStorage},showModuleTypeMismatchWarning:function(e,t){try{const o=`\n                <div class="alert alert-warning mblock-type-warning" style="margin: 10px 0; position: relative; z-index: 1000;">\n                    <strong>Achtung:</strong> Das kopierte Element stammt aus einem anderen Modul-Typ.\n                    Das Einf\xfcgen ist nicht m\xf6glich.<br>\n                    <small>Aktueller Typ: <code>${e}</code> | Zwischenablage: <code>${t}</code></small>\n                    <button type="button" class="close" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); border: none; background: none; font-size: 18px;" onclick="$(this).parent().fadeOut()">&times;</button>\n                </div>\n            `,n=$(".mblock_wrapper").first();n.length?n.before(o):$("body").prepend(o)}catch(o){console.error("MBlock: Fehler beim Anzeigen der Modultyp-Warnung:",o),$("body").prepend('<div style="background: #f8d7da; color: #721c24; padding: 10px; margin: 10px 0; border: 1px solid #f5c6cb; border-radius: 4px; z-index: 9999;">Das kopierte Element kann hier nicht eingef\xfcgt werden (anderer Modul-Typ).</div>')}},getModuleType:function(e){try{const t=e.closest("form");if(t.length){const e=t.find('input[name="module_id"]').first();if(e.length)return"module_"+e.val()}const o=e.find('input[name="module_id"]').first();if(o.length)return"module_"+o.val();const n=e.find('input[name*="module_id"], input[name*="module_name"]').first();if(n.length){return n.attr("name")+"_"+n.val()}if(t.length){const e=t.attr("action");if(e){const t=new URLSearchParams(e.split("?")[1]).get("module_id");if(t)return"module_"+t}}const i=(e.attr("class")||"").match(/mblock-module-(\w+)/);if(i)return i[1];const c=e.closest("[id]");if(c.length)return"parent_"+c.attr("id");const l=new URLSearchParams(window.location.search),r=l.get("module_id")||l.get("article_id");return r?"url_module_"+r:(console.warn("MBlock: Keine Modul-ID erkannt - verwende unknown_module"),"unknown_module")}catch(t){return console.warn("MBlock: Fehler beim Ermitteln des Modultyps:",t),"unknown_module"}},copy:function(e,t){try{if(!t||!t.length)return console.warn("MBlock: Invalid item passed to copy"),!1;const o=t.closest(".mblock_wrapper"),n=this.getModuleType(o),i=t.clone(!0,!0);this.convertSelectpickerToPlainSelect(i);const c=this.captureComplexFormData(t);return this.data={html:i.prop("outerHTML"),formData:c,moduleType:n,timestamp:Date.now(),source:e.attr("class")||"mblock_wrapper"},this.showCopiedState(t),this.saveToStorage(),this.updatePasteButtons(),!0}catch(o){return console.error("MBlock: Fehler beim Kopieren:",o),!1}},captureComplexFormData:function(e){const t={};try{return e.find("input, textarea, select").each(function(){const e=$(this),o=e.attr("name"),n=e.attr("type");o&&(t[o]="checkbox"===n||"radio"===n?{type:"checkbox_radio",checked:e.is(":checked"),value:e.val()}:e.is("select")?{type:"select",value:e.val(),multiple:e.prop("multiple")}:{type:"input",value:e.val()})}),e.find(".cke5-editor").each(function(){const e=$(this).attr("id");if(e&&window.CKEDITOR&&window.CKEDITOR.instances[e]){const o=window.CKEDITOR.instances[e].getData();t[e]={type:"ckeditor",value:o}}}),e.find('input[id^="REX_LINK_"]').each(function(){const e=$(this),o=e.attr("id"),n=e.val();t[o]={type:"rex_link",value:n};const i=o.replace("REX_LINK_","REX_LINK_NAME_"),c=$("#"+i);c.length&&(t[i]={type:"rex_link_display",value:c.val()})}),e.find('input[id^="REX_MEDIA_"]').each(function(){const e=$(this),o=e.attr("id"),n=e.val();t[o]={type:"rex_media",value:n}}),t}catch(o){return console.error("MBlock: Fehler beim Erfassen der Formulardaten:",o),t}},paste:function(e,t){try{if(this.loadFromStorage(),!this.data)return mblock_show_message(mblock_get_text("mblock_toast_clipboard_empty","Keine Daten in der Zwischenablage"),"warning",3e3),!1;const n=e.closest(".mblock_wrapper"),l=this.getModuleType(n),r=this.data.moduleType||"unknown_module";if(l!==r)return this.showModuleTypeMismatchWarning(l,r),!1;const s=$(this.data.html);this.cleanupPastedItem(s),t&&t.length?t.after(s):e.prepend(s),i(s,!0),c(s),s.find(".cke5-editor").each(function(){const e=$(this).attr("id");e&&window.CKEDITOR&&window.CKEDITOR.instances[e]&&window.CKEDITOR.instances[e].destroy()}),this.data.formData&&this.restoreNonCKEditorFormData(s,this.data.formData),mblock_init_sort(e),s.trigger("rex:ready",[s]);try{s.find(".mblock_wrapper").each(function(){const e=$(this);e.data("mblock_initialized")||(mblock_init(e),e.data("mblock_initialized",!0))})}catch(o){console.warn("MBlock: Error initializing nested MBlocks in pasted content:",o)}return this.data.formData&&setTimeout(()=>{this.restoreCKEditorFormData(s,this.data.formData)},100),setTimeout(()=>{"function"==typeof $.fn.selectpicker&&s.find("select.selectpicker").selectpicker("refresh"),"function"==typeof $.fn.chosen&&s.find("select").chosen("destroy").chosen(),s.find("input, select, textarea").trigger("change")},50),setTimeout(()=>{s&&s.length&&s.is(":visible")&&mblock_smooth_scroll_to_element(s.get(0))},100),setTimeout(()=>{MBlockUtils.animation.flashEffect(s),mblock_show_message(mblock_get_text("mblock_toast_paste_success","Block erfolgreich eingef\xfcgt!"),"success",3e3)},150),!0}catch(n){return console.error("MBlock: Fehler beim Einf\xfcgen:",n),!1}},cleanupPastedItem:function(e){try{e.removeAttr("data-mblock_index"),e.find("input, textarea, select").each(function(){const e=$(this);e.removeAttr("id");const t=e.attr("name");if(t){const o=t.replace(/_unique_\w+/,"");e.attr("name",o)}}),e.find("[id]").each(function(){const e=$(this),t=e.attr("id");t&&(t.includes("REX_")||t.includes("mblock"))&&e.removeAttr("id")})}catch(t){console.error("MBlock: Fehler beim Bereinigen des eingef\xfcgten Items:",t)}},restoreNonCKEditorFormData:function(e,t){try{Object.keys(t).forEach(o=>{const n=t[o];"ckeditor"!==n.type&&this.restoreFieldData(e.find('[name="'+o+'"]'),n,e,o)})}catch(o){console.error("MBlock: Fehler beim Wiederherstellen der Nicht-CKEditor-Daten:",o)}},restoreCKEditorFormData:function(e,t){try{Object.keys(t).forEach(o=>{const n=t[o];"ckeditor"===n.type&&e.find("#"+o).length&&window.CKEDITOR&&window.CKEDITOR.instances[o]&&window.CKEDITOR.instances[o].setData(n.value)})}catch(o){console.error("MBlock: Fehler beim Wiederherstellen der CKEditor-Daten:",o)}},restoreFieldData:function(e,t,o,n){switch(t.type){case"checkbox_radio":t.checked&&e.prop("checked",!0);break;case"select":e.val(t.value),"function"==typeof $.fn.selectpicker&&e.selectpicker("refresh");break;case"rex_link":if(e.val(t.value),t.value){const e=n.replace("REX_LINK_","REX_LINK_NAME_"),i=o.find("#"+e);i.length&&l(t.value,i)}break;case"rex_media":e.val(t.value);break;default:void 0!==t.value&&e.val(t.value)}},showCopiedState:function(e){MBlockUtils.animation.addGlowEffect(e,"mblock-copy-glow",1e3),mblock_show_message("\ud83d\udccb "+mblock_get_text("mblock_toast_copy_success","Block erfolgreich kopiert!"),"success",3e3);const t=e.find(".mblock-copy-btn");t.length&&MBlockUtils.animation.addGlowEffect(t,"is-copied",1e3)},updatePasteButtons:function(){const e=!!this.data;e?$(".mblock_wrapper").each((e,t)=>{const o=$(t),n=this.getModuleType(o)===(this.data.moduleType||"unknown_module");o.find(".mblock-paste-btn").each(function(){const e=$(this);e.toggleClass("disabled",!n),e.prop("disabled",!n),e.attr("title",n?"Block einf\xfcgen":"Block kann nicht eingef\xfcgt werden (anderer Modul-Typ)")})}):($(".mblock-paste-btn").addClass("disabled").prop("disabled",!0),$(".mblock-paste-btn").attr("title","No data in clipboard"));const t=$(".mblock-copy-paste-toolbar");e?t.show():t.hide()},convertSelectpickerToPlainSelect:function(e){try{e.find("select.selectpicker, .bootstrap-select select").each(function(){const e=$(this),t=e.closest(".bootstrap-select");t.length&&(t.before(e),t.remove()),e.removeClass("selectpicker"),e.removeAttr("data-live-search"),e.removeAttr("data-size"),e.removeAttr("data-style"),e.show()}),e.find(".bootstrap-select").each(function(){const e=$(this);0===e.find("select").length&&e.remove()})}catch(t){console.error("MBlock: Error converting selectpicker to plain select:",t)}},clear:function(){this.data=null,this.clearStorage(),this.updatePasteButtons()},getInfo:function(){return{hasData:!!this.data,storageMode:this.useSessionStorage?"Session":"Local",timestamp:this.data?this.data.timestamp:null,savedAt:this.data?this.data.savedAt:null,itemCount:this.data&&this.data.formData?Object.keys(this.data.formData).length:0}}},MBlockOnlineToggle={toggle:function(e,t){try{if(!t||!t.length)return console.warn("MBlock: Invalid item passed to toggle"),!1;const e=!t.hasClass("mblock-offline"),o=t.find(".mblock-online-toggle"),n=o.find("i");return e?(t.addClass("mblock-offline"),o.attr("title","Set online"),n.length&&n.removeClass("rex-icon-online").addClass("rex-icon-offline"),o.find(".toggle-text").text("Offline"),this.setOfflineState(t,!0)):(t.removeClass("mblock-offline"),o.attr("title","Set offline"),n.length&&n.removeClass("rex-icon-offline").addClass("rex-icon-online"),o.find(".toggle-text").text("Online"),this.setOfflineState(t,!1)),!0}catch(o){return console.error("MBlock: Fehler beim Online/Offline Toggle:",o),!1}},setOfflineState:function(e,t){try{const o=e.find('input[name*="mblock_offline"]');o.length?o.val(t?"1":"0"):console.warn("MBlock: No mblock_offline input found in item")}catch(o){console.error("MBlock: Fehler beim Setzen des Offline-Status:",o)}},initializeStates:function(e){try{e.find("> div.sortitem").each(function(){const e=$(this),t=e.find('input[name*="mblock_offline"]'),o=e.find(".mblock-online-toggle");t.length&&o.length&&("1"===t.val()?(e.addClass("mblock-offline"),o.attr("title","Set online"),o.find("i").removeClass("rex-icon-online").addClass("rex-icon-offline"),o.find(".toggle-text").text("Offline")):(e.removeClass("mblock-offline"),o.attr("title","Set offline"),o.find("i").removeClass("rex-icon-offline").addClass("rex-icon-online"),o.find(".toggle-text").text("Online")))})}catch(t){console.error("MBlock: Fehler beim Initialisieren der Online/Offline-States:",t)}},toggleAutoDetected:function(e,t,o){try{if(!(t&&t.length&&o&&o.length))return console.warn("MBlock: Invalid parameters for toggleAutoDetected"),!1;const e=!("1"===o.attr("data-offline")),n=t.find('input[name*="mblock_offline"]');if(!n.length)return console.warn("MBlock: No mblock_offline input found for auto-detected toggle"),!1;n.val(e?"1":"0");const i=e?"btn-danger":"btn-success",c=e?"rex-icon-offline":"rex-icon-online",l=e?"Set online":"Set offline",r=e?"Offline":"Online";o.removeClass("btn-default btn-warning btn-success btn-danger").addClass(i).attr("title",l).attr("data-offline",e?"1":"0");const s=o.find("i");s.length&&s.removeClass("rex-icon-online rex-icon-offline").addClass(c);const a=o.html().replace(/Offline|Online/,r);return o.html(a),e?t.addClass("mblock-offline"):t.removeClass("mblock-offline"),!0}catch(n){return console.error("MBlock: Fehler beim Auto-Detected Toggle:",n),!1}}},$(document).ready(function(){setTimeout(function(){r()},500),$(document).on("shown.bs.tab",function(){setTimeout(function(){r()},100)}),$(document).on("click",'.nav-tabs a, .nav-pills a, [data-toggle="tab"], [data-bs-toggle="tab"], .mform-tabs a',function(){setTimeout(function(){r()},200)}),$(document).on("mform:tabChanged mform:tabShow",function(){setTimeout(function(){r()},150)})}),$(document).on("rex:ready",function(e,t){t.find(".cke5-editor[data-cke5-restore-content]").each(function(){const e=$(this),t=e.attr("id"),o=e.attr("data-cke5-restore-content");t&&o&&(window.CKEDITOR&&window.CKEDITOR.instances[t]&&window.CKEDITOR.instances[t].setData(o),e.removeAttr("data-cke5-restore-content"))})}),"undefined"!=typeof module&&module.exports&&(module.exports={MBlockClipboard:MBlockClipboard,MBlockOnlineToggle:MBlockOnlineToggle});
//# sourceMappingURL=mblock.min.js.map