let mblock=".mblock_wrapper";const MBlockUtils={selectors:{wrapper:".mblock_wrapper",sortitem:"> div.sortitem",addme:".addme",removeme:".removeme",moveup:".moveup",movedown:".movedown",copyBtn:".mblock-copy-btn",pasteBtn:".mblock-paste-btn",onlineToggle:".mblock-online-toggle",autoToggle:".mblock-offline-toggle-btn"},dom:{findElement:(e,t)=>e?.find?e.find(t):$(t),safeRemove(element){if(element?.length){element.find("*").off(".mblock");element.off(".mblock");element.remove();return!0}return!1},createFromHTML:e=>$($.parseHTML(e))},events:{bindSafe(element,e,t,o=".mblock"){if(element?.length)element.off(e+o).on(e+o,t)},cleanup(element,e=".mblock"){if(mblock_validate_element(element)&&element.jquery){element.find("*").off(e);element.off(e)}}},state:{isDisabled:element=>element.prop("disabled")||element.hasClass("disabled"),toggleDisabled(element,e){element.prop("disabled",e);element.toggleClass("disabled",e)}},nested:{cleanupDuplicates(e){try{if(!e||!e.length)return;e.find(".mblock_wrapper").each(function(){const e=$(this);const t=e.find("> .mblock-single-add");if(t.length>1)t.slice(1).remove();const o=e.find("> .sortitem");if(o.length>0&&t.length>0)t.remove()})}catch(t){console.error("MBlock: Error cleaning up nested duplicates:",t)}},initializeNested(e){try{if(!e||!e.length)return;e.find(".mblock_wrapper").each(function(){const e=$(this);if(e.length){MBlockUtils.nested.cleanupDuplicates(e.parent());e.removeData("mblock_run")}})}catch(t){console.error("MBlock: Error initializing nested MBlocks:",t)}}},animation:{addGlowEffect(element,e="mblock-copy-glow",t=1e3){if(element?.length){element.addClass(e);setTimeout(()=>element.removeClass(e),t)}},flashEffect(element,e="mblock-dropped-flash",t=600){if(element?.length){element.addClass(e);setTimeout(()=>element.removeClass(e),t)}}},is:{validElement:element=>mblock_validate_element(element),rexField:(e,t)=>e&&e.indexOf(`REX_${t}_`)>=0,hiddenInput:element=>"hidden"===element.attr("type")}};function mblock_show_message(e,t="warning",o=5e3){if("undefined"!==typeof BLOECKS&&BLOECKS.fireMBlockToast)BLOECKS.fireMBlockToast(e,t,o);else if("undefined"!==typeof BLOECKS&&BLOECKS.showToast)BLOECKS.showToast(e,t,o);else{if("undefined"!==typeof MBLOCK_TOAST&&MBLOCK_TOAST.show){MBLOCK_TOAST.show(e,t,o);return}if("error"===t||"danger"===t)console.error("MBlock:",e);else console.warn("MBlock:",e)}}const MBLOCK_TOAST=(function(){let e=0;let t=null;function createContainer(){if(t)return t;t=document.createElement("div");t.className="mblock-toast-container";t.style.position="fixed";t.style.top="20px";t.style.right="20px";t.style.zIndex=99999;t.style.display="flex";t.style.flexDirection="column";t.style.gap="8px";document.body.appendChild(t);return t}function show(t,o="info",n=4e3){try{const i=createContainer();const l="mblock-toast-"+ ++e;const c=document.createElement("div");c.id=l;c.className="mblock-toast mblock-toast-"+o;c.style.minWidth="180px";c.style.maxWidth="420px";c.style.padding="10px 14px";c.style.borderRadius="4px";c.style.boxShadow="0 2px 8px rgba(0,0,0,0.12)";c.style.background="error"===o||"danger"===o?"#f8d7da":"success"===o?"#d4edda":"#fff3cd";c.style.color="#222";c.style.border="1px solid rgba(0,0,0,0.06)";c.style.fontSize="13px";c.innerText=t;i.appendChild(c);setTimeout(()=>{try{c.style.opacity="0";c.style.transition="opacity 250ms ease"}catch(e){}},Math.max(50,n-250));setTimeout(()=>{try{if(c.parentNode)c.parentNode.removeChild(c)}catch(e){}},n+100);return l}catch(i){console.warn("MBlock: Toast fallback failed",i);return!1}}return{show:show}})();function mblock_get_text(e,t=""){if("undefined"!==typeof rex&&rex.mblock_i18n&&rex.mblock_i18n[e.replace("mblock_toast_","")])return rex.mblock_i18n[e.replace("mblock_toast_","")];if("undefined"!==typeof rex&&rex.i18n){const o=rex.i18n.msg(e);return o!==e?o:t}const o={mblock_toast_copy_success:{de:"Block erfolgreich kopiert!",en:"Block copied successfully!",es:"\xa1Bloque copiado con \xe9xito!",pt:"Bloco copiado com sucesso!",sv:"Block kopierat framg\xe5ngsrikt!",nl:"Blok succesvol gekopieerd!"},mblock_toast_paste_success:{de:"Block erfolgreich eingef\xfcgt!",en:"Block pasted successfully!",es:"\xa1Bloque pegado con \xe9xito!",pt:"Bloco colado com sucesso!",sv:"Block inklistrat framg\xe5ngsrikt!",nl:"Blok succesvol geplakt!"},mblock_toast_clipboard_empty:{de:"Keine Daten in der Zwischenablage",en:"No data in clipboard",es:"No hay datos en el portapapeles",pt:"Nenhum dado na \xe1rea de transfer\xeancia",sv:"Inga data i urklipp",nl:"Geen gegevens in klembord"},mblock_toast_module_type_mismatch:{de:"Modultyp stimmt nicht \xfcberein",en:"Module type mismatch",es:"No coincide el tipo de m\xf3dulo",pt:"Tipo de m\xf3dulo n\xe3o corresponde",sv:"Modultyp matchar inte",nl:"Moduletype komt niet overeen"}};const n=(navigator.language||"de").substring(0,2);const i=o[e];if(i&&i[n])return i[n];else if(i&&i["de"])return i["de"];return t}function mblock_validate_element(element){try{if(!element)return!1;if(element.jquery)return element.length>0&&"function"===typeof element.data;if(element.nodeType)return!0;if("string"===typeof element)return element.length>0;else return!1}catch(e){console.error("MBlock: Fehler bei Element-Validierung:",e);return!1}}function mblock_cleanup_events(element,e=".mblock"){try{if(mblock_validate_element(element)&&element.jquery){element.find("*").off(e);element.off(e)}}catch(t){console.error("MBlock: Fehler bei Event-Cleanup:",t)}}function checkCopyPasteEnabled(){try{const e=$(mblock).first();if(e.length){const t=e.attr("data-copy_paste");if(void 0!==t)return"1"===t||"true"===t||!0===t}const t=$(".mblock-copy-btn").length>0;const o=$(".mblock-copy-paste-toolbar").length>0;return t||o}catch(e){console.warn("MBlock: Fehler beim Pr\xfcfen der Copy/Paste-Konfiguration:",e);return!0}}function mblock_smooth_scroll_to_element(element,e={}){if(!element)return;if("undefined"!==typeof BLOECKS&&"function"===typeof BLOECKS.scrollToSlice)try{BLOECKS.scrollToSlice(element);return}catch(o){console.warn("MBlock: Bloecks scroll failed, using fallback:",o)}const t={behavior:"smooth",block:"center",inline:"nearest",offset:-20,...e};try{if("scrollIntoView"in element){const e=element.getBoundingClientRect();const o=e.top+window.pageYOffset;const n=o+t.offset;window.scrollTo({top:Math.max(0,n),behavior:t.behavior})}else element.scrollIntoView({behavior:t.behavior,block:t.block,inline:t.inline})}catch(o){try{element.scrollIntoView()}catch(n){console.warn("MBlock: Smooth scroll nicht verf\xfcgbar:",n)}}}if("undefined"!==typeof module&&module.exports)module.exports={MBlockUtils:MBlockUtils,mblock_show_message:mblock_show_message,mblock_get_text:mblock_get_text,mblock_validate_element:mblock_validate_element};const MBlockSortable={destroy(element){try{const e=element?.get?element.get(0):element;if(e&&e._sortable){if("function"===typeof e._sortable.destroy)e._sortable.destroy();e._sortable=null;return!0}}catch(e){console.warn("MBlock: Sortable destroy error:",e);if(element?.get){const e=element.get(0);if(e)e._sortable=null}}return!1},create(element){try{if(!element?.length||!element.get)return!1;const e=element.get(0);if(!document.contains(e)||"undefined"===typeof Sortable)return!1;const t=Sortable.create(e,{handle:".sorthandle",animation:150,ghostClass:"sortable-ghost",chosenClass:"mblock-sortable-chosen",dragClass:"mblock-dragging",onStart:e=>this._handleStart(e),onEnd:e=>this._handleEnd(e,element),onError:e=>console.error("MBlock: Sortable Fehler:",e)});e._sortable=t;return!0}catch(e){console.error("MBlock: Fehler beim Erstellen der Sortable-Instanz:",e);return!1}},reinitialize(element){this.destroy(element);setTimeout(()=>this.create(element),10)},_handleStart(e){try{document.body.classList.add("mblock-drag-active");if(e.item)e.item.classList.add("mblock-dragging")}catch(t){console.error("MBlock: Fehler in sortable onStart:",t)}},_handleEnd(e,element){try{document.body.classList.remove("mblock-drag-active");if(e.item){e.item.classList.remove("mblock-dragging");MBlockUtils.animation.flashEffect($(e.item))}mblock_reindex(element);mblock_remove(element);const t=$(e.item);if(t.length)t.trigger("mblock:change",[t])}catch(t){console.error("MBlock: Fehler in sortable onEnd:",t)}}};$(document).on("rex:ready",function(e,t){try{const e=checkCopyPasteEnabled();if(e&&"undefined"!==typeof MBlockClipboard)MBlockClipboard.init();if(t&&"function"===typeof t.find)t.find(mblock).each(function(){const e=$(this);if(e.length)try{const o=t.closest(".mblock_wrapper").length>0;if(o)return;mblock_init(e)}catch(o){console.error("MBlock: Fehler beim Initialisieren eines einzelnen MBlock-Elements:",o)}});else $(mblock).each(function(){const e=$(this);if(e.length)mblock_init(e)})}catch(o){console.error("MBlock: Fehler bei rex:ready:",o)}});function mblock_init(element){try{if(!element||!element.length||"function"!==typeof element.data){console.warn("MBlock: Ung\xfcltiges Element bei mblock_init");return!1}const e=element.data("mblock_run");if(!e){element.data("mblock_run",1);mblock_sort(element);mblock_set_unique_id(element,!1);const e=element.data("min");const t=element.data("max");if(1==e&&1==t)element.addClass("hide_removeadded").addClass("hide_sorthandle")}else element.find(".mblock-single-add").remove();mblock_add_plus(element);mblock_init_toolbar(element);if("undefined"!==typeof MBlockOnlineToggle)MBlockOnlineToggle.initializeStates(element);return!0}catch(e){console.error("MBlock: Fehler in mblock_init:",e);return!1}}function mblock_init_sort(element){try{if(!element||!element.length)return!1;mblock_reindex(element);mblock_sort(element);return!0}catch(e){console.error("MBlock: Fehler in mblock_init_sort:",e);return!1}}function mblock_sort(element){try{if(!element||!element.length)return!1;mblock_add(element);mblock_remove(element);mblock_sort_it(element);return!0}catch(e){console.error("MBlock: Fehler in mblock_sort:",e);return!1}}function mblock_add_plus(element){const e=element.find("> div.sortitem").length>0;const t=element.find("> div.mblock-single-add").length>0;if(!e&&!t){element.prepend($($.parseHTML(element.data("mblock-single-add"))));element.find("> div.mblock-single-add .addme").unbind().bind("click",function(){mblock_add_item(element,!1);$(this).parents(".mblock-single-add").remove()})}else if(e&&t);}function mblock_remove(element){var e=element.find("> div.sortitem");if(1==e.length){e.find(".removeme").prop("disabled",!0);e.find(".removeme").attr("data-disabled",!0)}else{e.find(".removeme").prop("disabled",!1);e.find(".removeme").attr("data-disabled",!1)}if(element.data().hasOwnProperty("max"))if(e.length>=element.data("max"))element.find(".addme").prop("disabled",!0);else element.find(".addme").prop("disabled",!1);if(element.data().hasOwnProperty("min"))if(e.length<=element.data("min"))element.find(".removeme").prop("disabled",!0);else element.find(".removeme").prop("disabled",!1);e.each(function(t){if(t+1==element.data("min")&&e.length==element.data("min"))$(this).find(".removeme").prop("disabled",!0);if(0==t)$(this).find(".moveup").prop("disabled",!0);else $(this).find(".moveup").prop("disabled",!1);if(t+1==e.length)$(this).find(".movedown").prop("disabled",!0);else $(this).find(".movedown").prop("disabled",!1)})}function mblock_sort_it(element){try{if(!MBlockUtils.is.validElement(element)||!element.length||!element.get){console.warn("MBlock: Ung\xfcltiges Element f\xfcr mblock_sort_it");return!1}const e=element.get(0);if(!document.contains(e)){console.warn("MBlock: Element nicht mehr im DOM");return!1}if("undefined"!==typeof Sortable&&Sortable.create){MBlockSortable.reinitialize(element);return!0}else{console.error("MBlock: Sortable.js ist nicht verf\xfcgbar");return!1}}catch(e){console.error("MBlock: Fehler in mblock_sort_it:",e);return!1}}function mblock_reindex(element){try{if(!mblock_validate_element(element)){console.warn("MBlock: Ung\xfcltiges Element bei mblock_reindex");return!1}const e=element.data("mblock_count")||0;const t=element.find("> div.sortitem");if(!t.length)return!0;t.each(function(t){const o=$(this);const n=t+1;o.attr("data-mblock_index",n);mblock_reindex_form_elements(o,t,n,e);mblock_reindex_special_elements(o,t,n,e)});mblock_replace_for(element);return!0}catch(e){console.error("MBlock: Fehler in mblock_reindex:",e);return!1}}function mblock_reindex_form_elements(e,t,o,n){try{e.find("input,textarea,select,button").each(function(e){const i=$(this);const l=e+1;const c=i.attr("name");if(c&&"undefined"!==typeof c){let e=c;e=e.replace("mblock_new_","");if(e.match(/REX_(MEDIALIST|LINKLIST)_SELECT\[\d+\]$/))e=e.replace(/\[\d+\]$/,"["+t+"]");else{const o=e.match(/\]\[\d+\]\[/g);if(o)e=e.replace(o,"]["+t+"][")}if(e!==c)i.attr("name",e)}const s=i.attr("type");if("checkbox"===s)i.off("change.mblock").on("change.mblock",function(){$(this).val($(this).is(":checked")?1:0)});if("radio"===s){const e=i.attr("data-value");if(e)i.val(e)}mblock_update_rex_ids(i,o,n,l)})}catch(i){console.error("MBlock: Fehler in mblock_reindex_form_elements:",i)}}function mblock_update_rex_ids(e,t,o,n){try{const i=e.attr("id");const l=e.prop("nodeName");if(!i)return;const c=t+o+"00"+n;if("SELECT"===l&&(i.includes("REX_MEDIALIST_SELECT_")||i.includes("REX_LINKLIST_SELECT_"))){const t=i.replace(/_\d+$/,"_"+c);e.attr("id",t);e.closest(".rex-js-widget-medialist, .rex-js-widget-linklist, .form-group").data("widget-suffix",c);return}if("INPUT"===l&&(i.includes("REX_MEDIA_")||i.includes("REX_MEDIALIST_")||i.includes("REX_LINKLIST_"))){let l=c;if(i.includes("REX_MEDIALIST_")||i.includes("REX_LINKLIST_")){const t=e.closest(".rex-js-widget-medialist, .rex-js-widget-linklist, .form-group");const o=t.data("widget-suffix");if(o)l=o}const s=i.replace(/\d+$/,l);e.attr("id",s);mblock_update_rex_buttons(e,t,o,n,l);return}}catch(i){console.error("MBlock: Fehler in mblock_update_rex_ids:",i)}}function mblock_update_rex_buttons(e,t,o,n,i){try{const l=i||t+o+"00"+n;const c=e.closest(".rex-js-widget, .rex-js-widget-media, .rex-js-widget-medialist, .rex-js-widget-linklist, .form-group");c.find('a.btn-popup, a[onclick*="REX"]').each(function(){const e=$(this);const t=e.attr("onclick");if(t){const o=t.replace(/\('?\d+/g,"('"+l).replace(/_\d+/g,"_"+l);e.attr("onclick",o)}})}catch(l){console.error("MBlock: Fehler in mblock_update_rex_buttons:",l)}}function mblock_reindex_special_elements(e,t,o,n){try{e.find('a[data-toggle="tab"]').each(function(e){const t=e+1;const i=$(this);const l=i.attr("href");if(l){const e=l.replace(/_\d+/,"_"+o+n+"00"+t);i.attr("href",e);const c=i.parent().parent().parent().find(".tab-content "+l);if(c.length)c.attr("id",e.replace("#",""));i.off("shown.bs.tab.mblock").on("shown.bs.tab.mblock",function(e){try{const t=$(e.target).attr("href");if(t&&"undefined"!==typeof localStorage)localStorage.setItem("selectedTab",t)}catch(t){console.warn("MBlock: LocalStorage nicht verf\xfcgbar:",t)}})}});e.find('a[data-toggle="collapse"]').each(function(e){const t=e+1;const i=$(this);if(!i.attr("data-ignore-mblock")){const e=i.attr("data-target");if(e){const l=e.replace(/_\d+/,"_"+o+n+"00"+t);i.attr("data-target",l);const c=i.parent().find(e);if(c.length)c.attr("id",l.replace("#",""));const s=i.parent().parent().parent().find(".panel-group");if(s.length){const e="accgr_"+o+n+"00";s.attr("id",e);i.attr("data-parent","#"+e)}}}});e.find(".custom-link").each(function(e){const t=e+1;const i=$(this);i.find("input").each(function(){const e=$(this);const i=e.attr("id");if(i)e.attr("id",i.replace(/\d+/,o+n+"00"+t))});i.find("a.btn-popup").each(function(){const e=$(this);const i=e.attr("id");if(i)e.attr("id",i.replace(/\d+/,o+n+"00"+t))});i.attr("data-id",o+n+"00"+t);if("function"===typeof window.mform_custom_link)try{window.mform_custom_link(i)}catch(l){console.warn("MBlock: MForm custom link Fehler:",l)}})}catch(i){console.error("MBlock: Fehler in mblock_reindex_special_elements:",i)}}function mblock_replace_for(element){element.find("> div.sortitem").each(function(e){var t=$(this);t.find("input:not(:checkbox):not(:radio),textarea,select").each(function(e){var o=$(this),n=o.attr("id"),i=o.attr("name");if(typeof n!==typeof void 0&&!1!==n&&typeof i!==typeof void 0&&!1!==i)if(!(n.indexOf("REX_MEDIA")>=0||n.indexOf("REX_LINK")>=0||n.indexOf("redactor")>=0||n.indexOf("markitup")>=0)){var l=t.find('label[for="'+n+'"]');i=i.replace(/(\[|\])/gm,"");o.attr("id",i);l.attr("for",i)}})})}function mblock_add_item(element,item){const e=MBlockUtils.dom.createFromHTML(element.data("mblock-plain-sortitem"));e.find("input:radio, input:checkbox").each(function(){$(this).parent().removeAttr("for")});e.find("input:radio, input:checkbox").each(function(){$(this).attr("name","mblock_new_"+$(this).attr("name"));$(this).attr("data-value",$(this).val())});if(!1===item)element.prepend(e);else if(item.parent().hasClass(element.attr("class"))){MBlockSortable.destroy(element);item.after(e);mblock_set_count(element,item)}mblock_set_unique_id(e,!0);mblock_init_sort(element);e.trigger("rex:ready",[e]);setTimeout(function(){MBlockUtils.nested.initializeNested(e);if("function"===typeof $.fn.selectpicker){var t=e.find("select.selectpicker");if(t.length){t.selectpicker({noneSelectedText:"\u2014"}).on("rendered.bs.select",function(){$(this).parent().removeClass("bs3-has-addon")});t.selectpicker("refresh")}}if("function"===typeof $.fn.chosen)e.find("select.chosen").chosen();if("function"===typeof mblock_reinitialize_redaxo_widgets)mblock_reinitialize_redaxo_widgets(e);e.find("input, select, textarea").trigger("change");if("undefined"!==typeof MBlockUtils&&MBlockUtils.animation&&MBlockUtils.animation.addGlowEffect)MBlockUtils.animation.addGlowEffect(e);setTimeout(function(){if(e&&e.length&&e.is(":visible"))mblock_scroll(element,e)},200)},50)}function mblock_set_unique_id(item,e){try{if(!item||!item.length||"function"!==typeof item.find){console.warn("MBlock: Ung\xfcltiges Item bei mblock_set_unique_id");return!1}item.find("input").each(function(){try{const t=$(this);const o=1==t.attr("data-unique-int");const n=1==t.attr("data-unique")||o;if(n){let n;if(o)n=Math.floor(1e12*Math.random());else n=Math.random().toString(16).slice(2);if(!0===e)t.val("");if(""===t.val()||null===t.val())t.val(n)}}catch(t){console.error("MBlock: Fehler bei unique_id Generierung:",t)}});return!0}catch(t){console.error("MBlock: Fehler in mblock_set_unique_id:",t);return!1}}function mblock_set_count(element,item){var e=item.next().find("span.mb_count"),t=element.find("> div.sortitem").length;if(element.data("latest"))t=element.data("latest")+1;e.text(t);element.data("latest",t)}function mblock_remove_item(element,item){try{if(!MBlockUtils.is.validElement(element)||!element.length||!item||!item.length){console.warn("MBlock: Ung\xfcltige Parameter bei mblock_remove_item");return!1}const e=element.data();if(e&&e.hasOwnProperty("delete_confirm"))if(!confirm(e.delete_confirm))return!1;const t=item.parent();const o=element.attr("class");if(t.length&&o&&t.hasClass(o)){MBlockSortable.destroy(element);let e=item.prev();if(!e.length||!e.hasClass("sortitem"))e=item.next();if(MBlockUtils.dom.safeRemove(item)){mblock_init_sort(element);if(e&&e.length)mblock_scroll(element,e);mblock_add_plus(element);return!0}else{console.error("MBlock: Fehler beim Entfernen des Items");return!1}}return!1}catch(e){console.error("MBlock: Fehler in mblock_remove_item:",e);return!1}}function mblock_moveup(element,item){var e=item.prev();if(0!=e.length)setTimeout(function(){item.insertBefore(e);mblock_reindex(element);mblock_remove(element);let t=e;t.trigger("mblock:change",[t])},150)}function mblock_movedown(element,item){var e=item.next();if(0!=e.length)setTimeout(function(){item.insertAfter(e);mblock_reindex(element);mblock_remove(element);let t=e;t.trigger("mblock:change",[t])},150)}function mblock_scroll(element,item){try{if(!element||!element.length||!item||!item.length)return!1;const e=element.data();if(e&&e.hasOwnProperty("smooth_scroll")&&!0===e.smooth_scroll)if("function"===typeof $.mblockSmoothScroll){$.mblockSmoothScroll({scrollTarget:item,speed:500});return!0}if(item.length&&item.offset()){const e=item.offset().top;const t=$(window).height();const o=$(window).scrollTop();if(e<o||e>o+t-200)$("html, body").animate({scrollTop:e-100},300)}return!0}catch(e){console.error("MBlock: Fehler in mblock_scroll:",e);return!1}}function mblock_add(element){try{if(!MBlockUtils.is.validElement(element)||!element.length){console.warn("MBlock: Ung\xfcltiges Element bei mblock_add");return!1}const e=[{selector:MBlockUtils.selectors.addme,event:"click",handler:function(e){e.preventDefault();try{const $this=$(this);if(!MBlockUtils.state.isDisabled($this)){const $item=$this.parents(".sortitem");const e=$item.attr("data-mblock_index");if(e)element.attr("data-mblock_clicked_add_item",e);mblock_add_item(element,$this.closest('div[class^="sortitem"]'))}}catch(t){console.error("MBlock: Fehler in addme click handler:",t)}return!1}},{selector:MBlockUtils.selectors.removeme,event:"click",handler:function(e){e.preventDefault();try{const $this=$(this);if(!MBlockUtils.state.isDisabled($this))mblock_remove_item(element,$this.closest('div[class^="sortitem"]'))}catch(t){console.error("MBlock: Fehler in removeme click handler:",t)}return!1}},{selector:MBlockUtils.selectors.moveup,event:"click",handler:function(e){e.preventDefault();try{const $this=$(this);if(!MBlockUtils.state.isDisabled($this))mblock_moveup(element,$this.closest('div[class^="sortitem"]'))}catch(t){console.error("MBlock: Fehler in moveup click handler:",t)}return!1}},{selector:MBlockUtils.selectors.movedown,event:"click",handler:function(e){e.preventDefault();try{const $this=$(this);if(!MBlockUtils.state.isDisabled($this))mblock_movedown(element,$this.closest('div[class^="sortitem"]'))}catch(t){console.error("MBlock: Fehler in movedown click handler:",t)}return!1}}];e.forEach(({selector:e,event:t,handler:o})=>{const n=MBlockUtils.dom.findElement(element,`${MBlockUtils.selectors.sortitem} ${e}`);MBlockUtils.events.bindSafe(n,t,o)});if(checkCopyPasteEnabled())mblock_add._bindCopyPasteHandlers(element);mblock_add._bindToggleHandlers(element);if(checkCopyPasteEnabled()&&"undefined"!==typeof MBlockClipboard)MBlockClipboard.updatePasteButtons();if("undefined"!==typeof MBlockOnlineToggle)MBlockOnlineToggle.initializeStates(element);return!0}catch(e){console.error("MBlock: Fehler in mblock_add:",e);return!1}}mblock_add._bindCopyPasteHandlers=function(element){const e=MBlockUtils.dom.findElement(element,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.copyBtn}`);if(e.length>0)MBlockUtils.events.bindSafe(e,"click",function(e){e.preventDefault();try{const $this=$(this);const $item=$this.closest('div[class^="sortitem"]');if("undefined"!==typeof MBlockClipboard)MBlockClipboard.copy(element,$item)}catch(t){console.error("MBlock: Fehler in copy click handler:",t)}return!1});const t=MBlockUtils.dom.findElement(element,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.pasteBtn}`);if(t.length>0)MBlockUtils.events.bindSafe(t,"click",function(e){e.preventDefault();try{const $this=$(this);if(!MBlockUtils.state.isDisabled($this)){const $item=$this.closest('div[class^="sortitem"]');if("undefined"!==typeof MBlockClipboard)MBlockClipboard.paste(element,$item)}}catch(t){console.error("MBlock: Fehler in paste click handler:",t)}return!1})};mblock_add._bindToggleHandlers=function(element){const e=MBlockUtils.dom.findElement(element,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.onlineToggle}`);MBlockUtils.events.bindSafe(e,"click",function(e){e.preventDefault();try{const $this=$(this);const $item=$this.closest('div[class^="sortitem"]');if("undefined"!==typeof MBlockOnlineToggle)MBlockOnlineToggle.toggle(element,$item)}catch(t){console.error("MBlock: Fehler in online/offline toggle handler:",t)}return!1});const t=MBlockUtils.dom.findElement(element,`${MBlockUtils.selectors.sortitem} ${MBlockUtils.selectors.autoToggle}`);MBlockUtils.events.bindSafe(t,"click",function(e){e.preventDefault();try{const $this=$(this);const $item=$this.closest('div[class^="sortitem"]');if("undefined"!==typeof MBlockOnlineToggle)MBlockOnlineToggle.toggleAutoDetected(element,$item,$this)}catch(t){console.error("MBlock: Fehler in auto-detected toggle handler:",t)}return!1})};function mblock_init_toolbar(element){try{if(!checkCopyPasteEnabled())return;const e=[{selector:".mblock-copy-paste-toolbar .mblock-paste-btn",handler:function(e){e.preventDefault();try{const $this=$(this);if(!MBlockUtils.state.isDisabled($this))if("undefined"!==typeof MBlockClipboard)MBlockClipboard.paste(element,!1)}catch(t){console.error("MBlock: Fehler in toolbar paste click handler:",t)}return!1}},{selector:".mblock-copy-paste-toolbar .mblock-clear-clipboard",handler:function(e){e.preventDefault();try{if("undefined"!==typeof MBlockClipboard)MBlockClipboard.clear()}catch(t){console.error("MBlock: Fehler in clear clipboard click handler:",t)}return!1}}];e.forEach(({selector:e,handler:t})=>{const o=MBlockUtils.dom.findElement(element,e);MBlockUtils.events.bindSafe(o,"click",t)})}catch(e){console.error("MBlock: Fehler in mblock_init_toolbar:",e)}}if("undefined"!==typeof module&&module.exports)module.exports={MBlockSortable:MBlockSortable};var MBlockClipboard={data:null,storageKey:"mblock_clipboard",useSessionStorage:!0,init:function(){try{const e=this.loadFromStorage();if(this.data);}catch(e){console.warn("MBlock: Fehler beim Initialisieren des Clipboards:",e)}},getStorage:function(){try{return this.useSessionStorage?sessionStorage:localStorage}catch(e){console.warn("MBlock: Storage nicht verf\xfcgbar:",e);return null}},saveToStorage:function(){try{const e=this.getStorage();if(e&&this.data){e.setItem(this.storageKey,JSON.stringify({...this.data,savedAt:(new Date).toISOString(),sessionId:this.getSessionId()}));return!0}}catch(e){console.warn("MBlock: Fehler beim Speichern in Storage:",e)}return!1},loadFromStorage:function(){try{const e=this.getStorage();if(e){const t=e.getItem(this.storageKey);if(t){const e=JSON.parse(t);if(!this.useSessionStorage&&e.savedAt){const t=new Date(e.savedAt);const o=new Date;const n=(o-t)/(1e3*60*60);if(n>24){this.clearStorage();return!1}}this.data=e;this.updatePasteButtons();return!0}}}catch(e){console.warn("MBlock: Fehler beim Laden aus Storage:",e);this.clearStorage()}return!1},clearStorage:function(){try{const e=this.getStorage();if(e)e.removeItem(this.storageKey)}catch(e){console.warn("MBlock: Fehler beim Leeren des Storages:",e)}},getSessionId:function(){if(!this._sessionId)this._sessionId=Date.now().toString()+Math.random().toString(36).substr(2,9);return this._sessionId},toggleStorageMode:function(){const e=this.data;this.clearStorage();this.useSessionStorage=!this.useSessionStorage;if(e){this.data=e;this.saveToStorage()}return this.useSessionStorage},showModuleTypeMismatchWarning:function(e,t){try{const o=`\n                <div class="alert alert-warning mblock-type-warning" style="margin: 10px 0; position: relative; z-index: 1000;">\n                    <strong>Achtung:</strong> Das kopierte Element stammt aus einem anderen Modul-Typ. \n                    Das Einf\xfcgen ist nicht m\xf6glich.<br>\n                    <small>Aktueller Typ: <code>${e}</code> | Zwischenablage: <code>${t}</code></small>\n                    <button type="button" class="close" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); border: none; background: none; font-size: 18px;" onclick="$(this).parent().fadeOut()">&times;</button>\n                </div>\n            `;const n=$(".mblock_wrapper").first();if(n.length){$(".mblock-type-warning").remove();n.prepend(o);setTimeout(function(){$(".mblock-type-warning").fadeOut("slow")},5e3)}else alert("Das kopierte Element stammt aus einem anderen Modul und kann hier nicht eingef\xfcgt werden.")}catch(o){console.error("MBlock: Fehler beim Anzeigen der Modultyp-Warnung:",o);alert("Das kopierte Element kann hier nicht eingef\xfcgt werden (anderer Modul-Typ).")}},getModuleType:function(e){try{const t=e.closest("form");if(t.length){const e=t.find('input[name="module_id"]').first();if(e.length){const t=e.val();if(t)return"module_"+t}}const o=e.find('input[name="module_id"]').first();if(o.length){const e=o.val();if(e)return"module_"+e}const n=e.find('input[name*="module_id"], input[name*="module_name"]').first();if(n.length){const e=n.val();if(e)return"module_"+e}if(t.length){const e=t.attr("action")||"";const o=e.match(/module_id=(\d+)/);if(o)return"module_"+o[1]}const i=e.attr("class")||"";const l=i.match(/mblock-module-(\w+)/);if(l)return l[1];const c=e.closest("[id]");if(c.length){const e=c.attr("id");if(e.includes("module"))return e}const s=new URLSearchParams(window.location.search);const r=s.get("module_id")||s.get("article_id");if(r)return"context_"+r;console.warn("MBlock: Keine Modul-ID erkannt - verwende unknown_module");return"unknown_module"}catch(t){console.warn("MBlock: Fehler beim Ermitteln des Modultyps:",t);return"unknown_module"}},copy:function(element,item){try{if(!item||!item.length){console.warn("MBlock: Kein Item zum Kopieren gefunden");return!1}const e=item.closest(".mblock_wrapper");const t=this.getModuleType(e);const o=item.clone(!0,!0);this.convertSelectpickerToPlainSelect(o);const n=this.captureComplexFormData(item);this.data={html:o.prop("outerHTML"),formData:n,moduleType:t,timestamp:Date.now(),source:element.attr("class")||"mblock_wrapper"};this.showCopiedState(item);const i=this.saveToStorage();this.updatePasteButtons();return!0}catch(e){console.error("MBlock: Fehler beim Kopieren:",e);return!1}},captureComplexFormData:function(item){const e={};try{item.find("input, textarea, select").each(function(){const t=$(this);const o=t.attr("name")||t.attr("id");if(o)if(t.is(":checkbox")||t.is(":radio"))e[o]={type:"checkbox_radio",value:t.val(),checked:t.prop("checked"),defaultValue:t.attr("value")};else if(t.is("select")){const n=[];t.find("option:selected").each(function(){n.push($(this).val())});e[o]={type:"select",value:t.val(),selectedOptions:n,html:t.html()}}else e[o]={type:"input",value:t.val(),placeholder:t.attr("placeholder")}});item.find(".cke5-editor").each(function(){const t=$(this);const o=t.attr("name");if(o){let i=t.val();const l=t.attr("id");if(l&&"undefined"!==typeof ckeditors&&ckeditors[l])try{const e=ckeditors[l].getData();i=e}catch(n){console.warn("MBlock: Fehler beim Lesen der CKEditor5-Daten:",n)}else if(l&&window.CKEDITOR&&window.CKEDITOR.instances[l])try{const e=window.CKEDITOR.instances[l].getData();i=e}catch(n){console.warn("MBlock: Fehler beim Lesen der CKEditor4-Daten:",n)}else{const e=t.next(".ck-editor");if(e.length){const t=e.find(".ck-editor__editable");if(t.length)i=t.html()||i}}e[o]={type:"ckeditor",value:i,editorId:l,config:{lang:t.attr("data-lang"),profile:t.attr("data-profile"),"content-lang":t.attr("data-content-lang"),"min-height":t.attr("data-min-height"),"max-height":t.attr("data-max-height")}}}});item.find('input[id^="REX_LINK_"]').each(function(){const t=$(this);const o=t.attr("id");const n=t.attr("name");if(o&&!o.includes("_NAME")&&"hidden"===t.attr("type")){const i=t.val();const l=o+"_NAME";const c=$("#"+l);e[n]={type:"rex_link",value:i,hiddenId:o,displayId:l,displayValue:c.length?c.val():"",buttonOnclicks:{}};const s=t.closest(".input-group");if(s.length)s.find(".btn-popup").each(function(t){const o=$(this);const i=o.attr("onclick");if(i)e[n].buttonOnclicks["btn_"+t]=i})}});item.find('input[id^="REX_MEDIA_"]').each(function(){const t=$(this);const o=t.attr("id");const n=t.attr("name");if(o&&!o.includes("_NAME")&&"hidden"===t.attr("type")){const i=t.val();const l=o+"_NAME";const c=$("#"+l);e[n]={type:"rex_media",value:i,hiddenId:o,displayId:l,displayValue:c.length?c.val():"",buttonOnclicks:{}};const s=t.closest(".input-group, .rex-js-widget-media");if(s.length)s.find(".btn-popup").each(function(t){const o=$(this);const i=o.attr("onclick");if(i)e[n].buttonOnclicks["btn_"+t]=i})}});return e}catch(t){console.error("MBlock: Fehler beim Erfassen der Formulardaten:",t);return e}},paste:function(element,e){try{this.loadFromStorage();if(!this.data){console.warn("MBlock: Keine Daten in der Zwischenablage");const e="\u274c "+mblock_get_text("mblock_toast_clipboard_empty","Keine Daten in der Zwischenablage");mblock_show_message(e,"warning",3e3);return!1}const o=element.closest(".mblock_wrapper");const n=this.getModuleType(o);const i=this.data.moduleType||"unknown_module";if(n!==i){console.warn("MBlock: Modultyp stimmt nicht \xfcberein. Paste abgebrochen.",{current:n,clipboard:i});const e="\u26a0\ufe0f "+mblock_get_text("mblock_toast_module_type_mismatch","Modultyp stimmt nicht \xfcberein")+": "+i+" \u2260 "+n;mblock_show_message(e,"error",4e3);this.showModuleTypeMismatchWarning(n,i);return!1}const l=$(this.data.html);this.cleanupPastedItem(l);if(e&&e.length){if("undefined"!==typeof MBlockSortable)MBlockSortable.destroy(element);e.after(l)}else element.prepend(l);mblock_set_unique_id(l,!0);if("function"===typeof mblock_reinitialize_redaxo_widgets)mblock_reinitialize_redaxo_widgets(l);l.find(".cke5-editor").each(function(){const e=$(this);const t=e.attr("id");if(t&&"undefined"!==typeof ckeditors&&ckeditors[t])try{ckeditors[t].destroy();delete ckeditors[t]}catch(o){console.warn("MBlock: Error destroying CKEditor5:",o)}e.next(".ck-editor").remove();e.show()});if(this.data.formData)this.restoreNonCKEditorFormData(l,this.data.formData);mblock_init_sort(element);l.trigger("rex:ready",[l]);try{MBlockUtils.nested.initializeNested(l)}catch(t){console.warn("MBlock: Fehler beim Suchen nach verschachtelten MBlocks im eingef\xfcgten Inhalt:",t)}if(this.data.formData)setTimeout(()=>{this.restoreCKEditorFormData(l,this.data.formData)},500);setTimeout(()=>{if("function"===typeof $.fn.selectpicker){var e=l.find("select.mblock-needs-selectpicker");if(e.length){e.removeClass("mblock-needs-selectpicker").addClass("selectpicker");e.selectpicker({noneSelectedText:"\u2014"});e.selectpicker("refresh")}}l.find("input, select, textarea").trigger("change")},50);setTimeout(()=>{if(l&&l.length&&l.is(":visible"))mblock_smooth_scroll_to_element(l[0])},100);setTimeout(()=>{if(l&&l.length&&l.is(":visible")){MBlockUtils.animation.addGlowEffect(l,"mblock-paste-glow",1200);const e="\u2705 "+mblock_get_text("mblock_toast_paste_success","Block erfolgreich eingef\xfcgt!");mblock_show_message(e,"success",4e3)}},150);return!0}catch(o){console.error("MBlock: Fehler beim Einf\xfcgen:",o);return!1}},cleanupPastedItem:function(item){try{item.removeAttr("data-mblock_index");item.find("input, textarea, select").each(function(){const e=$(this);const t=e.attr("name");if(t&&-1===t.indexOf("mblock_new_"))e.attr("name","mblock_new_"+t);const o=e.attr("type");if("file"===o)e.val("");if(e.attr("data-unique")&&!e.val()){const t=Math.random().toString(16).slice(2);e.val(t)}});item.find("[id]").each(function(){const e=$(this);const t=e.attr("id");if(t&&!t.match(/^(REX_|ck)/))e.removeAttr("id")})}catch(e){console.error("MBlock: Fehler beim Bereinigen des eingef\xfcgten Items:",e)}},restoreNonCKEditorFormData:function(e,t){try{Object.keys(t).forEach(o=>{const n=t[o];if(!n||"object"!==typeof n)return;if("ckeditor"===n.type)return;let i=e.find(`[name="${o}"], [name="mblock_new_${o}"]`);if(i.length)this.restoreFieldData(i,n,e,o)})}catch(o){console.error("MBlock: Fehler beim Wiederherstellen der Nicht-CKEditor-Daten:",o)}},restoreCKEditorFormData:function(e,t){try{Object.keys(t).forEach(o=>{const n=t[o];if(!n||"object"!==typeof n)return;if("ckeditor"!==n.type)return;let i=e.find(`[name="${o}"], [name="mblock_new_${o}"]`);if(i.length)this.restoreFieldData(i,n,e,o)})}catch(o){console.error("MBlock: Fehler beim Wiederherstellen der CKEditor-Daten:",o)}},restoreFieldData:function(e,t,o,n){switch(t.type){case"checkbox_radio":e.val(t.value);e.prop("checked",t.checked);if(t.defaultValue)e.attr("value",t.defaultValue);break;case"select":if(t.html)e.html(t.html);e.val(t.value);break;case"ckeditor":if(t.value){e.val(t.value);const o=e.attr("id");if(o){const restoreCKE5Content=function(e=0){const n=15;if("undefined"!==typeof ckeditors&&ckeditors[o])try{ckeditors[o].setData(t.value);return}catch(i){console.warn("MBlock Restore: Failed to restore CKEditor5 content:",i)}else if(window.CKEDITOR&&window.CKEDITOR.instances[o])try{window.CKEDITOR.instances[o].setData(t.value);return}catch(i){console.warn("MBlock Restore: Failed to restore CKEditor4 content:",i)}if(e<n)setTimeout(()=>restoreCKE5Content(e+1),300);else console.warn("\u274c MBlock Restore: Timeout restoring content for",o,"after",n,"attempts")};setTimeout(()=>restoreCKE5Content(0),100)}}break;case"rex_link":if(void 0!==t.value){e.val(t.value);const n=o.find("#"+t.displayId);if(!n.length){const n=e.attr("id");if(n){const e=o.find("#"+n+"_NAME");if(e.length)if(t.displayValue)e.val(t.displayValue);else if(t.value)mblock_fetch_article_name(t.value,e)}}else if(t.displayValue)n.val(t.displayValue);else if(t.value)mblock_fetch_article_name(t.value,n);if(t.buttonOnclicks){const o=e.closest(".input-group");if(o.length)o.find(".btn-popup").each(function(o){const n=$(this);const i="btn_"+o;if(t.buttonOnclicks[i]){let o=t.buttonOnclicks[i];const l=e.attr("id");if(l&&t.hiddenId!==l){o=o.replace(new RegExp(t.hiddenId,"g"),l);const e=t.hiddenId.replace("REX_LINK_","");const n=l.replace("REX_LINK_","");o=o.replace(new RegExp("'"+e+"'","g"),"'"+n+"'")}n.attr("onclick",o)}})}}break;case"rex_media":if(void 0!==t.value){e.val(t.value);const n=o.find("#"+t.displayId);if(!n.length){const n=e.attr("id");if(n){const e=o.find("#"+n+"_NAME");if(e.length&&t.displayValue)e.val(t.displayValue)}}else if(t.displayValue)n.val(t.displayValue);if(t.buttonOnclicks){const o=e.closest(".input-group, .rex-js-widget-media");if(o.length)o.find(".btn-popup").each(function(o){const n=$(this);const i="btn_"+o;if(t.buttonOnclicks[i]){let o=t.buttonOnclicks[i];const l=e.attr("id");if(l&&t.hiddenId!==l){o=o.replace(new RegExp(t.hiddenId,"g"),l);const e=t.hiddenId.replace("REX_MEDIA_","");const n=l.replace("REX_MEDIA_","");o=o.replace(new RegExp("'"+e+"'","g"),"'"+n+"'")}n.attr("onclick",o)}})}}break;default:if(void 0!==t.value){e.val(t.value);if(t.placeholder)e.attr("placeholder",t.placeholder)}}},restoreComplexFormData:function(e,t){try{Object.keys(t).forEach(o=>{const n=t[o];if(!n||"object"!==typeof n)return;let i=e.find(`[name="${o}"], [name="mblock_new_${o}"]`);if(i.length)switch(n.type){case"checkbox_radio":i.val(n.value);i.prop("checked",n.checked);if(n.defaultValue)i.attr("value",n.defaultValue);break;case"select":if(n.html)i.html(n.html);i.val(n.value);break;case"ckeditor":if(n.value){i.val(n.value);const e=i.attr("id");if(e){i.attr("data-cke5-restore-content",n.value);if(n.config)Object.keys(n.config).forEach(e=>{if(n.config[e])i.attr("data-"+e,n.config[e])});const restoreCKE5Content=function(t=0){const o=25;if("undefined"!==typeof ckeditors&&ckeditors[e])try{ckeditors[e].setData(n.value);i.removeAttr("data-cke5-restore-content");return}catch(l){console.warn("MBlock Restore: Failed to restore CKEditor5 content:",l)}else if(window.CKEDITOR&&window.CKEDITOR.instances[e])try{window.CKEDITOR.instances[e].setData(n.value);i.removeAttr("data-cke5-restore-content");return}catch(l){console.warn("MBlock Restore: Failed to restore CKEditor4 content:",l)}if(t<o)setTimeout(()=>restoreCKE5Content(t+1),200);else{console.warn("\u274c MBlock Restore: Timeout restoring content for",e,"after",o,"attempts");i.removeAttr("data-cke5-restore-content")}};restoreCKE5Content(0);setTimeout(()=>restoreCKE5Content(0),500)}}break;case"rex_link":if(void 0!==n.value){i.val(n.value);const t=e.find("#"+n.displayId);if(!t.length){const t=i.attr("id");if(t){const o=e.find("#"+t+"_NAME");if(o.length)if(n.displayValue)o.val(n.displayValue);else if(n.value)mblock_fetch_article_name(n.value,o)}}else if(n.displayValue)t.val(n.displayValue);else if(n.value)mblock_fetch_article_name(n.value,t);if(n.buttonOnclicks){const e=i.closest(".input-group");if(e.length)e.find(".btn-popup").each(function(e){const t=$(this);const o="btn_"+e;if(n.buttonOnclicks[o]){let e=n.buttonOnclicks[o];const l=i.attr("id");if(l&&n.hiddenId!==l){e=e.replace(new RegExp(n.hiddenId,"g"),l);const t=n.hiddenId.replace("REX_LINK_","");const o=l.replace("REX_LINK_","");e=e.replace(new RegExp("'"+t+"'","g"),"'"+o+"'")}t.attr("onclick",e)}})}}break;case"rex_media":if(void 0!==n.value){i.val(n.value);const t=e.find("#"+n.displayId);if(!t.length){const t=i.attr("id");if(t){const o=e.find("#"+t+"_NAME");if(o.length&&n.displayValue)o.val(n.displayValue)}}else if(n.displayValue)t.val(n.displayValue);if(n.buttonOnclicks){const e=i.closest(".input-group, .rex-js-widget-media");if(e.length)e.find(".btn-popup").each(function(e){const t=$(this);const o="btn_"+e;if(n.buttonOnclicks[o]){let e=n.buttonOnclicks[o];const l=i.attr("id");if(l&&n.hiddenId!==l){e=e.replace(new RegExp(n.hiddenId,"g"),l);const t=n.hiddenId.replace("REX_MEDIA_","");const o=l.replace("REX_MEDIA_","");e=e.replace(new RegExp("'"+t+"'","g"),"'"+o+"'")}t.attr("onclick",e)}})}}break;default:if(void 0!==n.value){i.val(n.value);if(n.placeholder)i.attr("placeholder",n.placeholder)}}})}catch(o){console.error("MBlock: Fehler beim Wiederherstellen komplexer Formulardaten:",o)}},showCopiedState:function(item){MBlockUtils.animation.addGlowEffect(item,"mblock-copy-glow",1e3);const e="\ud83d\udccb "+mblock_get_text("mblock_toast_copy_success","Block erfolgreich kopiert!");mblock_show_message(e,"success",3e3);const t=item.find(".mblock-copy-btn");if(t.length)MBlockUtils.animation.addGlowEffect(t,"is-copied",1e3)},updatePasteButtons:function(){const e=!!this.data;if(e)$(".mblock_wrapper").each((e,t)=>{const o=$(t);const n=this.getModuleType(o);const i=this.data.moduleType||"unknown_module";const l=o.find(".mblock-paste-btn");if(n===i){l.removeClass("disabled").prop("disabled",!1);l.attr("title","Paste element (Module kompatibel)")}else{l.addClass("disabled").prop("disabled",!0);l.attr("title",`Cannot paste: Different module type (Current: ${n}, Clipboard: ${i})`)}});else{$(".mblock-paste-btn").addClass("disabled").prop("disabled",!0);$(".mblock-paste-btn").attr("title","No data in clipboard")}const t=$(".mblock-copy-paste-toolbar");if(e)t.show();else t.hide();const o=this.useSessionStorage?"Session":"Local"},convertSelectpickerToPlainSelect:function(e){try{const t=e.find("select.selectpicker, .bootstrap-select select");t.each(function(){const e=$(this);const t=e.val();const o=e.clone();o.removeClass("selectpicker bs-select-hidden");o.removeAttr("data-live-search data-live-search-placeholder tabindex aria-describedby");o.removeData();o.css("display","");o.addClass("mblock-needs-selectpicker");o.val(t);const n=e.parents(".bootstrap-select");if(n.length>0){const e=n.last();e.replaceWith(o)}else e.replaceWith(o)});e.find(".bootstrap-select").each(function(){const e=$(this);if(!e.find("select").length)e.remove()})}catch(t){console.error("MBlock: Error converting selectpicker to plain select:",t)}},clear:function(){this.data=null;this.clearStorage();this.updatePasteButtons()},getInfo:function(){return{hasData:!!this.data,storageMode:this.useSessionStorage?"Session":"Local",timestamp:this.data?this.data.timestamp:null,savedAt:this.data?this.data.savedAt:null,itemCount:this.data&&this.data.formData?Object.keys(this.data.formData).length:0}}};var MBlockOnlineToggle={toggle:function(element,item){try{if(!item||!item.length){console.warn("MBlock: Kein Item f\xfcr Online/Offline Toggle gefunden");return!1}const e=!item.hasClass("mblock-offline");const t=item.find(".mblock-online-toggle");const o=t.find("i");if(e){item.addClass("mblock-offline");t.removeClass("btn-online").addClass("btn-offline").attr("title","Set online");if(o.length)o.removeClass("rex-icon-online").addClass("rex-icon-offline");else t.html('<i class="rex-icon rex-icon-offline"></i>');this.setOfflineState(item,!0)}else{item.removeClass("mblock-offline");t.removeClass("btn-offline").addClass("btn-online").attr("title","Set offline");if(o.length)o.removeClass("rex-icon-offline").addClass("rex-icon-online");else t.html('<i class="rex-icon rex-icon-online"></i>');this.setOfflineState(item,!1)}return!0}catch(e){console.error("MBlock: Fehler beim Online/Offline Toggle:",e);return!1}},setOfflineState:function(item,e){try{const t=item.find('input[name*="mblock_offline"]');if(t.length)t.val(e?"1":"0");else console.warn("MBlock: No mblock_offline input found - must be defined in template for this functionality")}catch(t){console.error("MBlock: Fehler beim Setzen des Offline-Status:",t)}},initializeStates:function(element){try{element.find("> div.sortitem").each(function(e){const $item=$(this);const t=$item.attr("data-mblock_index")||e;let o=$item.find('input[name*="mblock_offline"]');if(!o.length)o=$item.find('input[name*="_offline"]');if(!o.length)o=$item.find('input[value="1"][type="hidden"]');const n=$item.find(".mblock-online-toggle");const i=n.find("i");if(n.length){const e=o.length&&("1"===o.val()||1===o.val());if(e){$item.addClass("mblock-offline");n.removeClass("btn-online").addClass("btn-offline").attr("title","Set online");if(i.length)i.removeClass("rex-icon-online").addClass("rex-icon-offline");else n.html('<i class="rex-icon rex-icon-offline"></i>')}else{$item.removeClass("mblock-offline");n.removeClass("btn-offline").addClass("btn-online").attr("title","Set offline");if(i.length)i.removeClass("rex-icon-offline").addClass("rex-icon-online");else n.html('<i class="rex-icon rex-icon-online"></i>')}}})}catch(e){console.error("MBlock: Fehler beim Initialisieren der Online/Offline-States:",e)}},toggleAutoDetected:function(element,item,e){try{if(!item||!item.length||!e||!e.length){console.warn("MBlock: Kein Item oder Button f\xfcr Auto-Detected Toggle gefunden");return!1}const t="1"===e.attr("data-offline");const o=!t;const n=item.find('input[name*="mblock_offline"]');if(!n.length){console.warn("MBlock: No mblock_offline input field found in item");return!1}n.val(o?"1":"0");const i=o?"btn-danger":"btn-success";const l=o?"rex-icon-offline":"rex-icon-online";const c=o?"Set online":"Set offline";const s=o?"Offline":"Online";e.removeClass("btn-default btn-warning btn-success btn-danger").addClass(i).attr("title",c).attr("data-offline",o?"1":"0");const r=e.find("i");if(r.length)r.removeClass("rex-icon-online rex-icon-offline").addClass(l);const a=e.html().replace(/Offline|Online/,s);e.html(a);if(o)item.addClass("mblock-offline");else item.removeClass("mblock-offline");return!0}catch(t){console.error("MBlock: Fehler beim Auto-Detected Toggle:",t);return!1}}};function mblock_reinitialize_redaxo_widgets(e){try{if(!e||!e.length)return!1;const t=parseInt(e.attr("data-mblock_index"))||1;const o=e.closest(".mblock_wrapper");const n=o.find(".sortitem").length||1;const i=e.closest(".gridblock_wrapper").length>0||e.hasClass("gridblock-item");e.find('input[id^="REX_MEDIA_"]').each(function(){const e=$(this);const t=e.attr("id");const o=e.attr("name");if(t){let o=e.closest(".rex-js-widget-media");if(!o.length)o=e.closest(".form-group, .col-sm-10, .input-group");if(o.length){const n=o.find('.btn-popup, a[onclick*="REXMedia"], a[onclick*="openREXMedia"]');n.each(function(){const e=$(this);let o=e.attr("onclick");if(o){const n=t.match(/REX_MEDIA_(\d+)/);if(n){const t=n[1];let i=o;if(o.includes("openREXMedia"))i=o.replace(/openREXMedia\([^,)]+/,`openREXMedia('${t}'`);else if(o.includes("viewREXMedia"))i=o.replace(/viewREXMedia\([^,)]+/,`viewREXMedia('${t}'`);else if(o.includes("deleteREXMedia"))i=o.replace(/deleteREXMedia\([^,)]+/,`deleteREXMedia('${t}'`);else if(o.includes("addREXMedia"))i=o.replace(/addREXMedia\([^,)]+/,`addREXMedia('${t}'`);else if(o.includes("openMedia"))i=o.replace(/openMedia\([^,)]+/,`openMedia('${t}'`);else if(o.includes("deleteMedia"))i=o.replace(/deleteMedia\([^,)]+/,`deleteMedia('${t}'`);if(i!==o)e.attr("onclick",i)}}});if(i){const t=o.find(".rex-media-preview, [data-media-id]");if(t.length){const o=e.val();if(o)t.attr("data-media-id",o)}}}else console.warn("MBlock: Kein Media-Widget-Container gefunden f\xfcr:",t)}});e.find('input[id^="REX_LINK_"]').each(function(){const t=$(this);const o=t.attr("id");const n=t.attr("name");if(o&&!o.includes("_NAME")&&"hidden"===t.attr("type")){let n=t.closest(".rex-js-widget-link, .form-group, .input-group");if(!n.length)n=t.parent();if(n.length){const i=n.find('.btn-popup, a[onclick*="REXLink"], a[onclick*="openLinkMap"]');i.each(function(){const e=$(this);let t=e.attr("onclick");if(t){const n=o.match(/REX_LINK_(\d+)/);if(n){const i=n[1];let l=t;if(t.includes("openLinkMap"))l=t.replace(/openLinkMap\([^,)]+/,`openLinkMap('${o}'`);else if(t.includes("deleteREXLink"))l=t.replace(/deleteREXLink\([^,)]+/,`deleteREXLink('${i}'`);else if(t.includes("openLink"))l=t.replace(/openLink\([^,)]+/,`openLink('${o}'`);else if(t.includes("deleteLink"))l=t.replace(/deleteLink\([^,)]+/,`deleteLink('${i}'`);if(l!==t)e.attr("onclick",l)}}});const l=o+"_NAME";const c=e.find("#"+l);const s=t.val();if(c.length&&s&&!c.val())mblock_fetch_article_name(s,c)}}});e.find('select[id^="REX_MEDIALIST_SELECT_"]').each(function(){const t=$(this);const o=t.attr("id");if(o){const n=e.find('input[id^="REX_MEDIALIST_"]');let i=t.closest(".rex-js-widget-medialist");if(!i.length)i=t.closest(".form-group, .col-sm-10, .input-group");if(i.length){const e=o.match(/REX_MEDIALIST_SELECT_(\d+)/);if(e){const t=e[1];const o=i.find('.btn-popup, a[onclick*="REXMedialist"]');o.each(function(){const e=$(this);let o=e.attr("onclick");if(o){let n=o;if(o.includes("moveREXMedialist"))n=o.replace(/moveREXMedialist\([^,)]+/,`moveREXMedialist('${t}'`);else if(o.includes("openREXMedialist"))n=o.replace(/openREXMedialist\([^,)]+/,`openREXMedialist('${t}'`);else if(o.includes("addREXMedialist"))n=o.replace(/addREXMedialist\([^,)]+/,`addREXMedialist('${t}'`);else if(o.includes("deleteREXMedialist"))n=o.replace(/deleteREXMedialist\([^,)]+/,`deleteREXMedialist('${t}'`);else if(o.includes("viewREXMedialist"))n=o.replace(/viewREXMedialist\([^,)]+/,`viewREXMedialist('${t}'`);if(n!==o)e.attr("onclick",n)}})}}}});e.find('select[id^="REX_LINKLIST_SELECT_"]').each(function(){const e=$(this);const t=e.attr("id");if(t){let o=e.closest(".rex-js-widget-linklist");if(!o.length)o=e.closest(".form-group, .col-sm-10, .input-group");if(o.length){const e=t.match(/REX_LINKLIST_SELECT_(\d+)/);if(e){const t=e[1];const n=o.find('.btn-popup, a[onclick*="REXLinklist"]');n.each(function(){const e=$(this);let o=e.attr("onclick");if(o){let n=o;if(o.includes("moveREXLinklist"))n=o.replace(/moveREXLinklist\([^,)]+/,`moveREXLinklist('${t}'`);else if(o.includes("openREXLinklist"))n=o.replace(/openREXLinklist\([^,)]+/,`openREXLinklist('${t}'`);else if(o.includes("addREXLinklist"))n=o.replace(/addREXLinklist\([^,)]+/,`addREXLinklist('${t}'`);else if(o.includes("deleteREXLinklist"))n=o.replace(/deleteREXLinklist\([^,)]+/,`deleteREXLinklist('${t}'`);else if(o.includes("viewREXLinklist"))n=o.replace(/viewREXLinklist\([^,)]+/,`viewREXLinklist('${t}'`);if(n!==o)e.attr("onclick",n)}})}}}});e.find('input[id^="REX_LINKLIST_"]').each(function(){const e=$(this);const t=e.attr("id");if(t){let o=e.closest(".rex-js-widget-linklist, .form-group");if(!o.length)o=e.parent();if(o.length)o.find('.btn-popup, a[onclick*="openLinklistMap"]').each(function(){const e=$(this);let o=e.attr("onclick");if(o&&o.includes("openLinklistMap")){const n=o.replace(/openLinklistMap\([^,)]+/,`openLinklistMap('${t}'`);if(n!==o)e.attr("onclick",n)}})}});if(i){e.trigger("rex:ready",[e]);e.find("input, select, textarea").trigger("rex:ready");if("function"===typeof window.gridblock_reinit_widgets)window.gridblock_reinit_widgets(e);setTimeout(()=>{if("function"===typeof $.fn.selectpicker)e.find("select.selectpicker").selectpicker("refresh")},100)}setTimeout(()=>{e.trigger("rex:ready",[e]);e.find("input, select, textarea").trigger("change")},50);return!0}catch(t){console.error("MBlock: Fehler bei der Reinitialisierung der REDAXO Widgets:",t);return!1}}function mblock_fetch_article_name(e,t){if(!e||!t||!t.length)return;if(!window.mblock_article_cache)window.mblock_article_cache={};if(window.mblock_article_cache[e]){t.val(window.mblock_article_cache[e]);return}const o=$('input[name="clang"]').val()||1;const n=rex.backend+"?page=structure/linkmap&opener_input_field=temp&article_id="+e+"&clang="+o;$.ajax({url:n,method:"GET",timeout:5e3,success:function(o){let n="";const i=[/<a[^>]+onclick="[^"]*selectLink[^"]*"[^>]*>([^<]+)</gi,/<span[^>]*class="[^"]*article[^"]*"[^>]*>([^<]+)</gi,/article_name['"]*:\s*['"]([^'"]+)['"]/gi,/"name"\s*:\s*"([^"]+)"/gi];for(const e of i){const t=e.exec(o);if(t&&t[1]&&t[1].trim()){n=t[1].trim();break}}if(!n)n="Artikel ["+e+"]";window.mblock_article_cache[e]=n;t.val(n);t.trigger("change")},error:function(){const o="Artikel ["+e+"]";window.mblock_article_cache[e]=o;t.val(o)}})}$(document).ready(function(){setTimeout(function(){mblock_initialize_empty_rex_link_fields()},500);$(document).on("shown.bs.tab",function(e){setTimeout(function(){mblock_initialize_empty_rex_link_fields()},100)});$(document).on("click",'.nav-tabs a, .nav-pills a, [data-toggle="tab"], [data-bs-toggle="tab"], .mform-tabs a',function(){setTimeout(function(){mblock_initialize_empty_rex_link_fields()},200)});$(document).on("mform:tabChanged mform:tabShow",function(e){setTimeout(function(){mblock_initialize_empty_rex_link_fields()},150)})});function mblock_initialize_empty_rex_link_fields(){try{let e=0;let t=0;$('input[id^="REX_LINK_"]').each(function(){const o=$(this);const n=o.attr("id");const i=o.val();e++;if(n&&!n.includes("_NAME")&&"hidden"===o.attr("type")&&i&&""!==i.trim()){const e=n+"_NAME";const o=$("#"+e);if(o.length){const e=o.val()||"";if(""===e.trim()){mblock_fetch_article_name(i,o);t++}}else console.warn("MBlock: Display-Feld nicht gefunden:",e,"(m\xf6glicherweise in verstecktem Tab)")}})}catch(e){console.error("MBlock: Fehler beim Initialisieren der REX_LINK Display-Felder:",e)}}$(document).on("rex:ready",function(e,t){t.find(".cke5-editor[data-cke5-restore-content]").each(function(){const t=$(this);const o=t.attr("id");const n=t.attr("data-cke5-restore-content");if(o&&n){const checkAndRestore=function(i=0){if(!(i>20)){if("undefined"!==typeof ckeditors&&ckeditors[o])try{ckeditors[o].setData(n);t.removeAttr("data-cke5-restore-content");return}catch(e){console.warn("MBlock: Error setting CKEditor5 data:",e)}setTimeout(()=>checkAndRestore(i+1),200)}else{console.warn("MBlock: Timeout restoring CKEditor5 content for",o);t.removeAttr("data-cke5-restore-content")}};setTimeout(()=>checkAndRestore(),300)}})});if("undefined"!==typeof module&&module.exports)module.exports={MBlockClipboard:MBlockClipboard,MBlockOnlineToggle:MBlockOnlineToggle};
//# sourceMappingURL=mblock.min.js.map